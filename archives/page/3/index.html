
<!DOCTYPE html>
<html lang="zh-CN">
    
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="generator" content="魏传柳">
    <title>Archives - 魏传柳</title>
    <meta name="author" content="魏传柳(langzi989)">
    
        <meta name="keywords" content="hexo,javascript,">
    
    
    
        <link rel="alternate" type="application/atom+xml" title="RSS" href="/atom.xml">
    
    <meta property="og:type" content="blog">
<meta property="og:title" content="魏传柳">
<meta property="og:url" content="http://yoursite.com/archives/page/3/index.html">
<meta property="og:site_name" content="魏传柳">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="魏传柳">
    
    
        
    
    
        <meta property="og:image" content="http://yoursite.com/assets/images/avar.jpg"/>
    
    
    
    
    <!--STYLES-->
    <link rel="stylesheet" href="/assets/css/style-nuvue6sithwirecbhvw3dkaobiojqvtadsnhguwi7k04xklybw5djl1smadp.min.css">
    <!--STYLES END-->
    
    
</head>

    <body>
        <div id="blog">
            <!-- Define author's picture -->


    
        
            
        
    

<header id="header" data-behavior="1">
    <i id="btn-open-sidebar" class="fa fa-lg fa-bars"></i>
    <h1 class="header-title">
        <a class="header-title-link" href="/ ">魏传柳</a>
    </h1>
    
        
            <a  class="header-right-picture "
                href="#about">
        
        
            <img class="header-picture" src="/assets/images/avar.jpg"/>
        
        </a>
    
</header>

            <!-- Define author's picture -->



        
    

<nav id="sidebar" data-behavior="1">
    
        <div class="sidebar-profile">
            <a href="/#about">
                    <img class="sidebar-profile-picture" src="/assets/images/avar.jpg"/>
            </a>
            <span class="sidebar-profile-name">魏传柳(langzi989)</span>
        </div>
    
    
        <ul class="sidebar-buttons">
        
            <li class="sidebar-button">
                
                    <a  class="sidebar-button-link "
                         href="/ "
                        
                    >
                
                    <i class="sidebar-button-icon fa fa-lg fa-home"></i>
                    <span class="sidebar-button-desc">home</span>
                </a>
        </li>
        
            <li class="sidebar-button">
                
                    <a  class="sidebar-button-link "
                         href="/all-categories"
                        
                    >
                
                    <i class="sidebar-button-icon fa fa-lg fa-bookmark"></i>
                    <span class="sidebar-button-desc">categories</span>
                </a>
        </li>
        
            <li class="sidebar-button">
                
                    <a  class="sidebar-button-link "
                         href="/all-tags"
                        
                    >
                
                    <i class="sidebar-button-icon fa fa-lg fa-tags"></i>
                    <span class="sidebar-button-desc">tags</span>
                </a>
        </li>
        
            <li class="sidebar-button">
                
                    <a  class="sidebar-button-link "
                         href="/all-archives"
                        
                    >
                
                    <i class="sidebar-button-icon fa fa-lg fa-archive"></i>
                    <span class="sidebar-button-desc">archives</span>
                </a>
        </li>
        
            <li class="sidebar-button">
                
                    <a  class="sidebar-button-link st-search-show-outputs"
                         href="#search"
                        
                    >
                
                    <i class="sidebar-button-icon fa fa-lg fa-search"></i>
                    <span class="sidebar-button-desc">search</span>
                </a>
        </li>
        
            <li class="sidebar-button">
                
                    <a  class="sidebar-button-link "
                         href="#about"
                        
                    >
                
                    <i class="sidebar-button-icon fa fa-lg fa-question"></i>
                    <span class="sidebar-button-desc">about</span>
                </a>
        </li>
        
    </ul>
    
        <ul class="sidebar-buttons">
        
            <li class="sidebar-button">
                
                    <a  class="sidebar-button-link " href="https://github.com/langzi989" target="_blank">
                
                    <i class="sidebar-button-icon fa fa-lg fa-github"></i>
                    <span class="sidebar-button-desc">GitHub</span>
                </a>
        </li>
        
            <li class="sidebar-button">
                
                    <a  class="sidebar-button-link " href="http://blog.csdn.net/u014630623" target="_blank">
                
                    <i class="sidebar-button-icon fa fa-lg fa-csdn"></i>
                    <span class="sidebar-button-desc">CSDN</span>
                </a>
        </li>
        
    </ul>
    
        <ul class="sidebar-buttons">
        
            <li class="sidebar-button">
                
                    <a  class="sidebar-button-link "
                         href="/atom.xml"
                        
                    >
                
                    <i class="sidebar-button-icon fa fa-lg fa-rss"></i>
                    <span class="sidebar-button-desc">RSS</span>
                </a>
        </li>
        
    </ul>
    
</nav>

            
            <div id="main" data-behavior="1"
                 class="
                        hasCoverMetaIn
                        ">
                
    

<section class="postShorten-group main-content-wrap">
    
    
    <article class="postShorten postShorten--thumbnailimg-bottom" itemscope itemType="http://schema.org/BlogPosting">
        <div class="postShorten-wrap">
            
            <div class="postShorten-header">
                <h1 class="postShorten-title" itemprop="headline">
                    
                        <a class="link-unstyled" href="/2017/05/22/Unix错误处理/">
                            Unix错误处理
                        </a>
                    
                </h1>
                <div class="postShorten-meta">
    <time itemprop="datePublished" datetime="2017-05-22T23:24:40+08:00">
	
		    5月 22, 2017
    	
    </time>
    
        <span>in </span>
        
    <a class="category-link" href="/categories/Linux环境高级编程/">Linux环境高级编程</a>


    
</div>

            </div>
            
                <div class="postShorten-content" itemprop="articleBody">
                    <h1 id="Unix错误处理"><a href="#Unix错误处理" class="headerlink" title="Unix错误处理"></a>Unix错误处理</h1><p>当Unix系统函数出错的时候，通常会返回一个负值，同时整型变量errno通常被设置为具有特定信息的值。例如当使用open打开文件的时候，若当前文件不存在，此时open的返回值为-1,errno被设置为2(ENOENT)。<br>系统函数出错的返回值不一定为负数，是根据具体函数具体定义的，如当系统函数返回一个指针时，若出错，将会返回NULL。</p>
<p>Linux系统中errno.h中定义了一系列的错误宏，他们之处了不同错误对应的错误ID，为整型变量，可被赋值。</p>
<blockquote>
<p>关于errno需要注意的两点：</p>
<ul>
<li>如果没出错，errno将不会被进程设置，所以一般当利用函数返回值确认已经出错的时候，再去查看相应的errno</li>
<li>任何函数不会讲errno的值设置为0,而且在errno.h中定义的所有宏定义都不为0</li>
</ul>
</blockquote>
<h2 id="Unix错误处理的两个相关函数"><a href="#Unix错误处理的两个相关函数" class="headerlink" title="Unix错误处理的两个相关函数"></a>Unix错误处理的两个相关函数</h2><h3 id="strerror函数"><a href="#strerror函数" class="headerlink" title="strerror函数"></a>strerror函数</h3><h4 id="函数原型"><a href="#函数原型" class="headerlink" title="函数原型"></a>函数原型</h4><figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string.h&gt;</span></span></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">char</span>* <span class="title">strerror</span><span class="params">(<span class="keyword">int</span> errno)</span></span>;</div></pre></td></tr></table></figure>
<h4 id="函数功能"><a href="#函数功能" class="headerlink" title="函数功能"></a>函数功能</h4><p>此函数的功能为将errno转化为其对应的具体错误信息。</p>
<h4 id="示例代码"><a href="#示例代码" class="headerlink" title="示例代码"></a>示例代码</h4><figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;errno.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string.h&gt;</span></span></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</div><div class="line">   <span class="keyword">int</span> fd = open(<span class="string">"data"</span>);</div><div class="line"></div><div class="line">   <span class="keyword">if</span> (fd == <span class="number">-1</span>) &#123;</div><div class="line">       <span class="built_in">printf</span>(<span class="string">"%s"</span>, strerror(errno));</div><div class="line">   &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="perror函数"><a href="#perror函数" class="headerlink" title="perror函数"></a>perror函数</h3><h4 id="函数原型-1"><a href="#函数原型-1" class="headerlink" title="函数原型"></a>函数原型</h4><figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">perror</span><span class="params">(<span class="keyword">const</span> <span class="keyword">char</span>* msg)</span></span>;</div></pre></td></tr></table></figure>
<h4 id="函数功能-1"><a href="#函数功能-1" class="headerlink" title="函数功能"></a>函数功能</h4><p>perror基于当前errno的值，在标准错误流上输出一个出错信息。输出内容首先输出msg所指的字符串，然后一个冒号，空格，接着是errno对应的错误字符串，最后是一个换行符。</p>
<h4 id="示例代码-1"><a href="#示例代码-1" class="headerlink" title="示例代码"></a>示例代码</h4><figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;errno.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;unistd.h&gt;</span></span></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">char</span> *argv[])</span> </span>&#123;</div><div class="line">   <span class="keyword">int</span> fd = open(<span class="string">"data"</span>);</div><div class="line"></div><div class="line">   <span class="keyword">if</span> (fd == <span class="number">-1</span>) &#123;</div><div class="line">       <span class="built_in">printf</span>(<span class="string">"%s"</span>, strerror(errno));</div><div class="line">       perror(argv[<span class="number">0</span>]);</div><div class="line">   &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="一些特殊的错误"><a href="#一些特殊的错误" class="headerlink" title="一些特殊的错误"></a>一些特殊的错误</h2><p>EAGAIN，EWOULDBLOCK和EINTR</p>
<p>在Linux环境下开发经常会碰到很多错误(设置errno)，其中EAGAIN是其中比较常见的一个错误(比如用在非阻塞操作中)。</p>
<p>从字面上来看，是提示再试一次。这个错误经常出现在当应用程序进行一些非阻塞(non-blocking)操作(对文件或socket)的时候。</p>
<p>　　例如，以 O_NONBLOCK的标志打开文件/socket/FIFO，如果你连续做read操作而没有数据可读。此时程序不会阻塞起来等待数据准备就绪返 回，</p>
<p>read函数会返回一个错误EAGAIN，提示你的应用程序现在没有数据可读请稍后再试。</p>
<p>　　又例如，当一个系统调用(比如fork)因为没有足够的资源(比如虚拟内存)而执行失败，返回EAGAIN提示其再调用一次(也许下次就能成功)。</p>
<p>EAGAIN：Linux - 非阻塞socket编程处理EAGAIN错误</p>
<p>　　在linux进行非阻塞的socket接收数据时经常出现Resource temporarily unavailable，errno代码为11(EAGAIN)，这是什么意思？</p>
<p>这表明你在非阻塞模式下调用了阻塞操作，在该操作没有完成就返回这个错误，这个错误不会破坏socket的同步，不用管它，下次循环接着recv就可以。</p>
<p>对非阻塞socket而言，EAGAIN不是一种错误。在VxWorks和Windows上，EAGAIN的名字叫做EWOULDBLOCK。</p>
<p>另外，如果出现EINTR即errno为4，错误描述Interrupted system call，操作也应该继续。</p>
<p>最后，如果recv的返回值为0，那表明连接已经断开，我们的接收操作也应该结束。</p>
<h2 id="错误恢复"><a href="#错误恢复" class="headerlink" title="错误恢复"></a>错误恢复</h2><p>我们可以将errno.h中定义的错误分为两种，分别是致命的和非致命的，对于致命性错误，无法执行恢复操作。对于非致命性错误，大多数来说是暂时的。</p>
<p>对于非致命性错误，最常用的做法就是延迟一段时间，然后重试。例如当错误表示网络不可用，这时我们将可以通过延迟一段时间，进行重新连接。</p>
<h2 id="errno宏定义及相应解释"><a href="#errno宏定义及相应解释" class="headerlink" title="errno宏定义及相应解释"></a>errno宏定义及相应解释</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div></pre></td><td class="code"><pre><div class="line"><span class="number">124</span> EMEDIUMTYPE   Wrong medium type</div><div class="line">　　<span class="number">123</span> ENOMEDIUM     No medium found</div><div class="line">　　<span class="number">122</span> EDQUOT        Disk quota exceeded</div><div class="line">　　<span class="number">121</span> EREMOTEIO     Remote I/O error</div><div class="line">　　<span class="number">120</span> EISNAM        Is a named type file</div><div class="line">　　<span class="number">119</span> ENAVAIL       No XENIX semaphores available</div><div class="line">　　<span class="number">118</span> ENOTNAM       Not a XENIX named type file</div><div class="line">　　<span class="number">117</span> EUCLEAN       Structure needs cleaning</div><div class="line">　　<span class="number">116</span> ESTALE        Stale NFS file handle</div><div class="line">　　<span class="number">115</span> EINPROGRESS  +Operation now in progress</div><div class="line">　　<span class="number">114</span> EALREADY      Operation already in progress</div><div class="line">　　<span class="number">113</span> EHOSTUNREACH  No route to host</div><div class="line">　　<span class="number">112</span> EHOSTDOWN     Host is down</div><div class="line">　　<span class="number">111</span> ECONNREFUSED  Connection refused</div><div class="line">　　<span class="number">110</span> ETIMEDOUT    +Connection timed out</div><div class="line">　　<span class="number">109</span> ETOOMANYREFS  Too many references: cannot splice</div><div class="line">　　<span class="number">108</span> ESHUTDOWN     Cannot send after transport endpoint shutdown</div><div class="line">　　<span class="number">107</span> ENOTCONN      Transport endpoint is not connected</div><div class="line">　　<span class="number">106</span> EISCONN       Transport endpoint is already connected</div><div class="line">　　<span class="number">105</span> ENOBUFS       No buffer space available</div><div class="line">　　<span class="number">104</span> ECONNRESET    Connection reset by peer</div><div class="line">　　<span class="number">103</span> ECONNABORTED  Software caused connection <span class="built_in">abort</span></div><div class="line">　　<span class="number">102</span> ENETRESET     Network dropped connection on reset</div><div class="line">　　<span class="number">101</span> ENETUNREACH   Network is unreachable</div><div class="line">　　<span class="number">100</span> ENETDOWN      Network is down</div><div class="line">　　<span class="number">99</span> EADDRNOTAVAIL Cannot assign requested address</div><div class="line">　　<span class="number">98</span> EADDRINUSE    Address already in use</div><div class="line">　　<span class="number">97</span> EAFNOSUPPORT  Address family not supported by protocol</div><div class="line">　　<span class="number">96</span> EPFNOSUPPORT  Protocol family not supported</div><div class="line">　　<span class="number">95</span> EOPNOTSUPP    Operation not supported</div><div class="line">　　<span class="number">94</span> ESOCKTNOSUPPORT Socket type not supported</div><div class="line">　　<span class="number">93</span> EPROTONOSUPPORT Protocol not supported</div><div class="line">　　<span class="number">92</span> ENOPROTOOPT   Protocol not available</div><div class="line">　　<span class="number">91</span> EPROTOTYPE    Protocol wrong type <span class="keyword">for</span> socket</div><div class="line">　　<span class="number">90</span> EMSGSIZE     +Message too <span class="keyword">long</span></div><div class="line">　　<span class="number">89</span> EDESTADDRREQ  Destination address required</div><div class="line">　　<span class="number">88</span> ENOTSOCK      Socket operation on non-socket</div><div class="line">　　<span class="number">87</span> EUSERS        Too many users</div><div class="line">　　<span class="number">86</span> ESTRPIPE      Streams pipe error</div><div class="line">　　<span class="number">85</span> ERESTART      Interrupted system call should be restarted</div><div class="line">　　<span class="number">84</span> EILSEQ        Invalid or incomplete multibyte or wide character</div><div class="line">　　<span class="number">83</span> ELIBEXEC      Cannot exec a shared library directly</div><div class="line">　　<span class="number">82</span> ELIBMAX       Attempting to link in too many shared libraries</div><div class="line">　　<span class="number">81</span> ELIBSCN       .lib section in a.out corrupted</div><div class="line">　　<span class="number">80</span> ELIBBAD       Accessing a corrupted shared library</div><div class="line">　　<span class="number">79</span> ELIBACC       Can not access a needed shared library</div><div class="line">　　<span class="number">78</span> EREMCHG       Remote address changed</div><div class="line">　　<span class="number">77</span> EBADFD        File descriptor in bad state</div><div class="line">　　<span class="number">76</span> ENOTUNIQ      Name not unique on network</div><div class="line">　　<span class="number">75</span> EOVERFLOW     Value too large <span class="keyword">for</span> defined data type</div><div class="line">　　<span class="number">74</span> EBADMSG      +Bad message</div><div class="line">　　<span class="number">73</span> EDOTDOT       RFS specific error</div><div class="line">　　<span class="number">72</span> EMULTIHOP     Multihop attempted</div><div class="line">　　<span class="number">71</span> EPROTO        Protocol error</div><div class="line">　　<span class="number">70</span> ECOMM         Communication error on send</div><div class="line">　　<span class="number">69</span> ESRMNT        Srmount error</div><div class="line">　　<span class="number">68</span> EADV          Advertise error</div><div class="line">　　<span class="number">67</span> ENOLINK       Link has been severed</div><div class="line">　　<span class="number">66</span> EREMOTE       Object is remote</div><div class="line">　　<span class="number">65</span> ENOPKG        Package not installed</div><div class="line">　　<span class="number">64</span> ENONET        Machine is not on the network</div><div class="line">　　<span class="number">63</span> ENOSR         Out of streams resources</div><div class="line">　　<span class="number">62</span> ETIME         Timer expired</div><div class="line">　　<span class="number">61</span> ENODATA       No data available</div><div class="line">　　<span class="number">60</span> ENOSTR        Device not a stream</div><div class="line">　　<span class="number">59</span> EBFONT        Bad font file format</div><div class="line">　　<span class="number">57</span> EBADSLT       Invalid slot</div><div class="line">　　<span class="number">56</span> EBADRQC       Invalid request code</div><div class="line">　　<span class="number">55</span> ENOANO        No anode</div><div class="line">　　<span class="number">54</span> EXFULL        Exchange full</div><div class="line">　　<span class="number">53</span> EBADR         Invalid request descriptor</div><div class="line">　　<span class="number">52</span> EBADE         Invalid exchange</div><div class="line">　　<span class="number">51</span> EL2HLT        Level <span class="number">2</span> halted</div><div class="line">　　<span class="number">50</span> ENOCSI        No CSI structure available</div><div class="line">　　<span class="number">49</span> EUNATCH       Protocol driver not attached</div><div class="line">　　<span class="number">48</span> ELNRNG        Link number out of range</div><div class="line">　　<span class="number">47</span> EL3RST        Level <span class="number">3</span> reset</div><div class="line">　　<span class="number">46</span> EL3HLT        Level <span class="number">3</span> halted</div><div class="line">　　<span class="number">45</span> EL2NSYNC      Level <span class="number">2</span> not synchronized</div><div class="line">　　<span class="number">44</span> ECHRNG        Channel number out of range</div><div class="line">　　<span class="number">43</span> EIDRM         Identifier removed</div><div class="line">　　<span class="number">42</span> ENOMSG        No message of desired type</div><div class="line">　　<span class="number">40</span> ELOOP         Too many levels of symbolic links</div><div class="line">　　<span class="number">39</span> ENOTEMPTY    +Directory not empty</div><div class="line">　　<span class="number">38</span> ENOSYS       +Function not implemented</div><div class="line">　　<span class="number">37</span> ENOLCK       +No locks available</div><div class="line">　　<span class="number">36</span> ENAMETOOLONG +File name too <span class="keyword">long</span></div><div class="line">　　<span class="number">35</span> EDEADLK      +Resource deadlock avoided</div><div class="line">　　<span class="number">34</span> ERANGE       +Numerical result out of range</div><div class="line">　　<span class="number">33</span> EDOM         +Numerical argument out of domain</div><div class="line">　　<span class="number">32</span> EPIPE        +Broken pipe</div><div class="line">　　<span class="number">31</span> EMLINK       +Too many links</div><div class="line">　　<span class="number">30</span> EROFS        +Read-only file system</div><div class="line">　　<span class="number">29</span> ESPIPE       +Illegal seek</div><div class="line">　　<span class="number">28</span> ENOSPC       +No space left on device</div><div class="line">　　<span class="number">27</span> EFBIG        +File too large</div><div class="line">　　<span class="number">26</span> ETXTBSY       Text file busy</div><div class="line">　　<span class="number">25</span> ENOTTY       +Inappropriate ioctl <span class="keyword">for</span> device</div><div class="line">　　<span class="number">24</span> EMFILE       +Too many open files</div><div class="line">　　<span class="number">23</span> ENFILE       +Too many open files in system</div><div class="line">　　<span class="number">22</span> EINVAL       +Invalid argument</div><div class="line">　　<span class="number">21</span> EISDIR       +Is a directory</div><div class="line">　　<span class="number">20</span> ENOTDIR      +Not a directory</div><div class="line">　　<span class="number">19</span> ENODEV       +No such device</div><div class="line">　　<span class="number">18</span> EXDEV        +Invalid cross-device link</div><div class="line">　　<span class="number">17</span> EEXIST       +File exists</div><div class="line">　　<span class="number">16</span> EBUSY        +Device or resource busy</div><div class="line">　　<span class="number">15</span> ENOTBLK       Block device required</div><div class="line">　　<span class="number">14</span> EFAULT       +Bad address</div><div class="line">　　<span class="number">13</span> EACCES       +Permission denied</div><div class="line">　　<span class="number">12</span> ENOMEM       +Cannot allocate memory</div><div class="line">　　<span class="number">11</span> EAGAIN       +Resource temporarily unavailable</div><div class="line">　　<span class="number">10</span> ECHILD       +No child processes</div><div class="line">　　<span class="number">9</span> EBADF        +Bad file descriptor</div><div class="line">　　<span class="number">8</span> ENOEXEC      +Exec format error</div><div class="line">　　<span class="number">7</span> E2BIG        +Argument <span class="built_in">list</span> too <span class="keyword">long</span></div><div class="line">　　<span class="number">6</span> ENXIO        +No such device or address</div><div class="line">　　<span class="number">5</span> EIO          +Input/output error</div><div class="line">　　<span class="number">4</span> EINTR        +Interrupted system call</div><div class="line">　　<span class="number">3</span> ESRCH        +No such process</div><div class="line">　　<span class="number">2</span> ENOENT       +No such file or directory</div><div class="line">　　<span class="number">1</span> EPERM        +Operation not permitted</div><div class="line">　　<span class="number">0</span>                    Success</div></pre></td></tr></table></figure>

                    
                        
                    
                    
                        <p>
                            <a href="/2017/05/22/Unix错误处理/#post-footer" class="postShorten-excerpt_link link">
                                Comment and share
                            </a>
                        </p>
                    
                </div>
            
        </div>
        
    </article>
    
    
    <article class="postShorten postShorten--thumbnailimg-bottom" itemscope itemType="http://schema.org/BlogPosting">
        <div class="postShorten-wrap">
            
            <div class="postShorten-header">
                <h1 class="postShorten-title" itemprop="headline">
                    
                        <a class="link-unstyled" href="/2017/05/22/Unix基础知识/">
                            Unix体系结构
                        </a>
                    
                </h1>
                <div class="postShorten-meta">
    <time itemprop="datePublished" datetime="2017-05-22T23:18:36+08:00">
	
		    5月 22, 2017
    	
    </time>
    
        <span>in </span>
        
    <a class="category-link" href="/categories/Linux环境高级编程/">Linux环境高级编程</a>


    
</div>

            </div>
            
                <div class="postShorten-content" itemprop="articleBody">
                    <h1 id="Unix基础知识"><a href="#Unix基础知识" class="headerlink" title="Unix基础知识"></a>Unix基础知识</h1><h2 id="Unix体系结构"><a href="#Unix体系结构" class="headerlink" title="Unix体系结构"></a>Unix体系结构</h2><p>从严格意义上讲，可以将操作系统定义为一种软件，它相当于一种控制计算机硬件资源，为程序提供运行环境的软件。我们通常将这种软件叫做内核，因为它相对比较小，并且位于环境的核心。Unix体系结构如下图:<br><img src="../assets/images/Unix体系结构.png" alt=""></p>
<p>内核的接口被称为系统调用（system Call），公共库函数建立在系统调用接口之上，<strong>应用程序既可以使用公共函数库，也可以使用系统调用。</strong>shell是一个特殊的应用程序，为运行其他应用程序提供了接口。</p>
<h2 id="Unix文件和目录"><a href="#Unix文件和目录" class="headerlink" title="Unix文件和目录"></a>Unix文件和目录</h2><h3 id="文件系统"><a href="#文件系统" class="headerlink" title="文件系统"></a>文件系统</h3><p>Unix文件系统是文件和目录的一种层次结构，所有文件的起点都是<strong>根目录(root)</strong>，名称为”/“.</p>
<p>目录是一个包含目录项的文件。逻辑上，可以认为每个目录项都包含一个文件，同时还说明该文件属性的信息。<strong>文件属性包括文件类型(普通文件还是目录)、文件权限、；链接到改文件的进程数、文件所有者、文件所有者所在的组 文件大小以及文件最后修改的时间等</strong>。stat和fstat函数返回一个文件属性的信息结构。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;sys/stat.h&gt;</span></span></div><div class="line"></div><div class="line"><span class="comment">//通过文件名获取文件信息，并保存在buf所指的结构体stat中</span></div><div class="line"><span class="comment">//返回值：成功返回0，失败-1，错误码存在errno中</span></div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">stat</span><span class="params">(<span class="keyword">const</span> <span class="keyword">char</span>* file_name, <span class="keyword">struct</span> stat* buf)</span></span>;</div><div class="line"></div><div class="line">数据类型：</div><div class="line"><span class="keyword">struct</span> stat &#123;</div><div class="line"><span class="keyword">dev_t</span>       st_dev;     <span class="comment">/* ID of device containing file -文件所在设备的ID*/</span>  </div><div class="line"></div><div class="line"><span class="keyword">ino_t</span>       st_ino;     <span class="comment">/* inode number -inode节点号*/</span>  </div><div class="line"></div><div class="line"><span class="keyword">mode_t</span>      st_mode;    <span class="comment">/* protection -保护模式?*/</span>  </div><div class="line"></div><div class="line"><span class="keyword">nlink_t</span>     st_nlink;   <span class="comment">/* number of hard links -链向此文件的连接数(硬连接)*/</span>  </div><div class="line"></div><div class="line"><span class="keyword">uid_t</span>       st_uid;     <span class="comment">/* user ID of owner -user id*/</span>  </div><div class="line"></div><div class="line"><span class="keyword">gid_t</span>       st_gid;     <span class="comment">/* group ID of owner - group id*/</span>  </div><div class="line"></div><div class="line"><span class="keyword">dev_t</span>       st_rdev;    <span class="comment">/* device ID (if special file) -设备号，针对设备文件*/</span>  </div><div class="line"></div><div class="line"><span class="keyword">off_t</span>       st_size;    <span class="comment">/* total size, in bytes -文件大小，字节为单位*/</span>  </div><div class="line"></div><div class="line"><span class="keyword">blksize_t</span>   st_blksize; <span class="comment">/* blocksize for filesystem I/O -系统块的大小*/</span>  </div><div class="line"></div><div class="line"><span class="keyword">blkcnt_t</span>    st_blocks;  <span class="comment">/* number of blocks allocated -文件所占块数*/</span>  </div><div class="line"></div><div class="line"><span class="keyword">time_t</span>      st_atime;   <span class="comment">/* time of last access -最近存取时间*/</span>  </div><div class="line"></div><div class="line"><span class="keyword">time_t</span>      st_mtime;   <span class="comment">/* time of last modification -最近修改时间*/</span>  </div><div class="line"></div><div class="line"><span class="keyword">time_t</span>      st_ctime;   <span class="comment">/* time of last status change - */</span>  </div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>使用C语言实现ls功能</p>
<p>涉及到的相关函数：</p>
<ul>
<li>文件夹操作函数opendir，readdir,closedir</li>
<li>opendir返回指向dir结构的指针，将该指针传递给readdir,无需关心dir结构中存在什么数据，直接读取即可。</li>
</ul>
<figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;dirent.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">err_quit</span><span class="params">(<span class="keyword">const</span> <span class="keyword">char</span>* message)</span> </span>&#123;</div><div class="line">  <span class="built_in">printf</span>(<span class="string">"%s\n"</span>, message);</div><div class="line">  <span class="built_in">exit</span>(<span class="number">0</span>);</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">char</span> *argv[])</span></span></div><div class="line">&#123;</div><div class="line">  <span class="keyword">if</span> (argc &lt; <span class="number">2</span>)</div><div class="line">  &#123;</div><div class="line">    err_quit(<span class="string">"usage: ls directory_name\n"</span>);</div><div class="line">    <span class="built_in">exit</span>(<span class="number">0</span>);</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  DIR *dp;</div><div class="line">  <span class="keyword">struct</span> dirent *dirp;</div><div class="line"></div><div class="line">  <span class="keyword">if</span> ((dp = opendir(argv[<span class="number">1</span>])) == <span class="literal">NULL</span>)</div><div class="line">    err_quit(<span class="string">"can not open file\n"</span>);</div><div class="line"></div><div class="line">  <span class="keyword">while</span> ((dirp = readdir(dp)) != <span class="literal">NULL</span>)</div><div class="line">    <span class="built_in">printf</span>(<span class="string">"%s\n"</span>, dirp-&gt;d_name);</div><div class="line">  closedir(dp);</div><div class="line">  <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="输入和输出"><a href="#输入和输出" class="headerlink" title="输入和输出"></a>输入和输出</h2><h3 id="文件描述符"><a href="#文件描述符" class="headerlink" title="文件描述符"></a>文件描述符</h3><p>文件描述符是一个很小的非负整数，<strong>内核用文件描述符来标识一个特定进程正在访问的文件</strong>。当内核打开或创建文件时，他都会返回一个文件描述符。在读写文件时，都可以使用这个描述符（根据打开时的模式赋予权限）.</p>
<h3 id="标准输入、标准输出和标准错误流"><a href="#标准输入、标准输出和标准错误流" class="headerlink" title="标准输入、标准输出和标准错误流"></a>标准输入、标准输出和标准错误流</h3><p>按照惯例，每当运行一个新程序的时候，所有的shell都会为改程序默认打开三个文件描述符，即标准输入，标准输出和标注错误。如果不做特殊处理，这三个描述符都连接到终端，也可以将其重定向到文件。如ls &gt; test.data</p>

                    
                        
                    
                    
                        <p>
                            <a href="/2017/05/22/Unix基础知识/#post-footer" class="postShorten-excerpt_link link">
                                Comment and share
                            </a>
                        </p>
                    
                </div>
            
        </div>
        
    </article>
    
    
    <article class="postShorten postShorten--thumbnailimg-bottom" itemscope itemType="http://schema.org/BlogPosting">
        <div class="postShorten-wrap">
            
            <div class="postShorten-header">
                <h1 class="postShorten-title" itemprop="headline">
                    
                        <a class="link-unstyled" href="/2017/05/21/函数dup/">
                            函数dup与dup2
                        </a>
                    
                </h1>
                <div class="postShorten-meta">
    <time itemprop="datePublished" datetime="2017-05-21T23:31:31+08:00">
	
		    5月 21, 2017
    	
    </time>
    
        <span>in </span>
        
    <a class="category-link" href="/categories/Linux环境高级编程/">Linux环境高级编程</a>


    
</div>

            </div>
            
                <div class="postShorten-content" itemprop="articleBody">
                    <h1 id="函数dup与dup2"><a href="#函数dup与dup2" class="headerlink" title="函数dup与dup2"></a>函数dup与dup2</h1><h2 id="函数原型"><a href="#函数原型" class="headerlink" title="函数原型"></a>函数原型</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;unistd.h&gt;</span></span></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">dup</span><span class="params">(<span class="keyword">int</span> fd)</span></span>;</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">dup2</span><span class="params">(<span class="keyword">int</span> fd, <span class="keyword">int</span> fd2)</span></span>;</div></pre></td></tr></table></figure>
<h2 id="函数功能"><a href="#函数功能" class="headerlink" title="函数功能"></a>函数功能</h2><p>这两个函数的功能都是用来复制一个现有的文件描述符。返回的文件描述符与原有的文件描述符共用同一个文件表项，但是文件描述符标志将被清除，即当进程调用exec时文件描述符将不会被关闭。</p>
<h2 id="返回值"><a href="#返回值" class="headerlink" title="返回值"></a>返回值</h2><p>dup返回当前可用的最小的文件描述符。dup2返回fd2，若fd2所表示的文件已经打开，则将该文件描述符先关闭，然后再将fd复制到fd2上返回。若fd2与fd相同，则直接返回fd、.</p>
<h2 id="等效函数"><a href="#等效函数" class="headerlink" title="等效函数"></a>等效函数</h2><p>dup函数与fcntl的F_DUPFD功能相同。</p>
<p>dup(fd)等效于fcntl(fd, F_DUPFD, 0)</p>
<p>dup2(fd, fd2)等效于close(fd), fcntl(fd, F_DUPFD, fd2)</p>
<p>但是dup2是原子的上述先关闭然后在复制不是原子操作。</p>
<h2 id="作用及用途"><a href="#作用及用途" class="headerlink" title="作用及用途"></a>作用及用途</h2><p>dup函数常用来重定向进程的stdin、stdout以及stderr。原理与CGI类似，即将标准输入标准输出重定向到一个文件或者socket流等。</p>
<h2 id="重定向标准输出"><a href="#重定向标准输出" class="headerlink" title="重定向标准输出"></a>重定向标准输出</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;unistd.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;errno.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;sys/types.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</div><div class="line">    <span class="keyword">int</span> fd = dup(STDIN_FILENO);</div><div class="line"></div><div class="line">    <span class="keyword">if</span> (fd &lt; <span class="number">0</span>) &#123;</div><div class="line">        <span class="built_in">printf</span>(<span class="string">"dup error\n"</span>);</div><div class="line">        <span class="built_in">exit</span>(<span class="number">1</span>);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">char</span> buf[] = <span class="string">"this is a test of dup\n"</span>;</div><div class="line">    write(fd, buf, <span class="keyword">sizeof</span>(buf));</div><div class="line">    <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>

                    
                        
                    
                    
                        <p>
                            <a href="/2017/05/21/函数dup/#post-footer" class="postShorten-excerpt_link link">
                                Comment and share
                            </a>
                        </p>
                    
                </div>
            
        </div>
        
    </article>
    
    
    <article class="postShorten postShorten--thumbnailimg-bottom" itemscope itemType="http://schema.org/BlogPosting">
        <div class="postShorten-wrap">
            
            <div class="postShorten-header">
                <h1 class="postShorten-title" itemprop="headline">
                    
                        <a class="link-unstyled" href="/2017/05/04/cgi原理/">
                            cgi原理
                        </a>
                    
                </h1>
                <div class="postShorten-meta">
    <time itemprop="datePublished" datetime="2017-05-04T20:36:55+08:00">
	
		    5月 04, 2017
    	
    </time>
    
        <span>in </span>
        
    <a class="category-link" href="/categories/Linux环境高级编程/">Linux环境高级编程</a>


    
</div>

            </div>
            
                <div class="postShorten-content" itemprop="articleBody">
                    <h1 id="CGI原理"><a href="#CGI原理" class="headerlink" title="CGI原理"></a>CGI原理</h1><p>CGI（Common Gateway Interface）通用网关接口，CGI描述了服务器和请求处理程序之间传输数据局的一种标准。在理解的过程中我们需要区分CGI和CGI程序，CGI是一种数据传输的标准，而CGI程序是实际处理业务的一个程序。webserver每请求一次，CGI程序就会fork出一个子进程进行处理。CGI程序的参数通过环境变量和标准输入获得，它的相应通过标准输出传递给webServer。</p>
<h2 id="CGI的工作原理是："><a href="#CGI的工作原理是：" class="headerlink" title="CGI的工作原理是："></a>CGI的工作原理是：</h2><ul>
<li>客户端通过http将请求发送到web服务器</li>
<li>web服务器接收并收集用户请求，然后交给CGI程序进行处理</li>
<li>CGI程序把处理后的结果发送给服务器</li>
<li>服务器将结果传送给浏览器</li>
</ul>
<p>其中上述第二步web服务器通过环境变量或标准输入将请求发送给CGI程序，第三步CGI通过标准输出将结果发送给webServer</p>
<h2 id="CGI接口标准：标准输入-环境变量以及标准输出"><a href="#CGI接口标准：标准输入-环境变量以及标准输出" class="headerlink" title="CGI接口标准：标准输入,环境变量以及标准输出"></a>CGI接口标准：标准输入,环境变量以及标准输出</h2><table>
<thead>
<tr>
<th style="text-align:left">借口标准</th>
<th>介绍</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">标准输入</td>
<td>CGI程序像其他可执行程序一样,可通过标准输入(stdin)从Web服务器得到输入信息,如Form中的数据,这就是所谓的向CGI程序传递数据的POST方法。这意味着在操作系统命令行状态可执行CGI程序,对CGI程序进行调试。POST方法是常用的方法。</td>
</tr>
<tr>
<td style="text-align:left">环境变量</td>
<td>操作系统提供了许多环境变量,它们定义了程序的执行环境,应用程序可以存取它们。Web服务器和CGI接口又另外设置了自己的一些环境变量,用来向CGI程序传递一些重要的参数。CGI的GET方法还通过环境变量QUERY-STRING向CGI程序传递Form中的数据。</td>
</tr>
<tr>
<td style="text-align:left">标准输出</td>
<td>CGI程序通过标准输出(stdout)将输出信息传送给Web服务器。传送给Web服务器的信息可以用各种格式,通常是以纯文本或者HTML文本的形式,这样我们就可以在命令行状态调试CGI程序,并且得到它们的输出。</td>
</tr>
</tbody>
</table>
<p>###常用的环境变量<br>Linux中的环境变量是一系列的键值对集合，它们的值可以通过shell设置，也可以被其他进程或程序设置和访问，它们是web服务器传递给CGI程序的一种最简单的方式，之所以叫做环境变量是因为它们是全局变量，任何程序都可以存取它们。</p>
<table>
<thead>
<tr>
<th style="text-align:center">key</th>
<th>意义</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">SERVER_NAME</td>
<td>CGI脚本运行时的主机名和IP地址</td>
</tr>
<tr>
<td style="text-align:center">SERVER_SOFTWARE</td>
<td>你的服务器的类型如： CERN/3.0 或 NCSA/1.3.</td>
</tr>
<tr>
<td style="text-align:center">GATEWAY_INTERFACE</td>
<td>运行的CGI版本. 对于UNIX服务器, 这是CGI/1.1</td>
</tr>
<tr>
<td style="text-align:center">SERVER_PROTOCOL</td>
<td>服务器运行的HTTP协议. 这里当是HTTP/1.0.</td>
</tr>
<tr>
<td style="text-align:center">SERVER_PORT</td>
<td>服务器运行的TCP口，通常Web服务器是80.</td>
</tr>
<tr>
<td style="text-align:center">REQUEST_METHOD</td>
<td>POST 或 GET, 取决于你的表单是怎样递交的</td>
</tr>
<tr>
<td style="text-align:center">HTTP_ACCEPT</td>
<td>浏览器能直接接收的Content-types, 可以有HTTP Accept header定义.</td>
</tr>
<tr>
<td style="text-align:center">HTTP_USER_AGENT</td>
<td>递交表单的浏览器的名称、版本 和其他平台性的附加信息。</td>
</tr>
<tr>
<td style="text-align:center">HTTP_REFERER</td>
<td>递交表单的文本的 URL，不是所有的浏览器都发出这个信息，不要依赖它</td>
</tr>
<tr>
<td style="text-align:center">PATH_INFO</td>
<td>附加的路径信息, 由浏览器通过GET方法发出.</td>
</tr>
<tr>
<td style="text-align:center">PATH_TRANSLATED</td>
<td>在PATH_INFO中系统规定的路径信息.</td>
</tr>
<tr>
<td style="text-align:center">SCRIPT_NAME</td>
<td>指向这个CGI脚本的路径, 是在URL中显示的(如, /cgi-bin/thescript).</td>
</tr>
<tr>
<td style="text-align:center"><strong>QUERY_STRING</strong></td>
<td><strong>脚本参数或者表单输入项(如果是用GET递交). QUERY_STRING包含URL中问号后面的参数</strong></td>
</tr>
<tr>
<td style="text-align:center">REMOTE_HOST</td>
<td>递交脚本的主机名，这个值不能被设置.</td>
</tr>
<tr>
<td style="text-align:center">REMOTE_ADDR</td>
<td>递交脚本的主机IP地址.</td>
</tr>
<tr>
<td style="text-align:center">REMOTE_USER</td>
<td>递交脚本的用户名. 如果服务器的authentication被激活，这个值可以设置。</td>
</tr>
<tr>
<td style="text-align:center">REMOTE_IDENT</td>
<td>如果Web服务器是在ident (一种确认用户连接你的协议)运行, 递交表单的系统也在运行ident, 这个变量就含有ident返回值.</td>
</tr>
<tr>
<td style="text-align:center">CONTENT_TYPE</td>
<td>如果表单是用POST递交, 这个值将是 application/x-www-form-urlencoded. 在上载文件的表单中, content-type 是个 multipart/form-data.</td>
</tr>
<tr>
<td style="text-align:center"><strong>CONTENT_LENGTH</strong></td>
<td><strong>对于用POST递交的表单,标准输入口的字节数.</strong></td>
</tr>
</tbody>
</table>
<h2 id="CGI的工作原理图"><a href="#CGI的工作原理图" class="headerlink" title="CGI的工作原理图"></a>CGI的工作原理图</h2><p><img src="../assets/images/CGI" alt=""></p>

                    
                        
                    
                    
                        <p>
                            <a href="/2017/05/04/cgi原理/#post-footer" class="postShorten-excerpt_link link">
                                Comment and share
                            </a>
                        </p>
                    
                </div>
            
        </div>
        
    </article>
    
    
    <article class="postShorten postShorten--thumbnailimg-bottom" itemscope itemType="http://schema.org/BlogPosting">
        <div class="postShorten-wrap">
            
            <div class="postShorten-header">
                <h1 class="postShorten-title" itemprop="headline">
                    
                        <a class="link-unstyled" href="/2017/05/04/Wait函数详解/">
                            Wait函数详解
                        </a>
                    
                </h1>
                <div class="postShorten-meta">
    <time itemprop="datePublished" datetime="2017-05-04T15:40:48+08:00">
	
		    5月 04, 2017
    	
    </time>
    
        <span>in </span>
        
    <a class="category-link" href="/categories/Linux环境高级编程/">Linux环境高级编程</a>


    
</div>

            </div>
            
                <div class="postShorten-content" itemprop="articleBody">
                    <h1 id="Wait函数详解"><a href="#Wait函数详解" class="headerlink" title="Wait函数详解"></a>Wait函数详解</h1><h2 id="kill"><a href="#kill" class="headerlink" title="kill"></a>kill</h2><h3 id="头文件"><a href="#头文件" class="headerlink" title="头文件"></a>头文件</h3><p>sys/types.h<br>signal.h</p>
<h3 id="函数原型"><a href="#函数原型" class="headerlink" title="函数原型"></a>函数原型</h3><p>int kill(pid_t pid, int sig);</p>
<p>返回值：执行成功返回0，执行失败返回-1。</p>
<h3 id="参数说明"><a href="#参数说明" class="headerlink" title="参数说明"></a>参数说明</h3><p>pid为进程ID,sig标识要发送的信号。</p>
<p>kill()函数的作用是用来向指定的进程或进程组发送信号。其中pid有一下<br>几种类型:</p>
<ul>
<li>pid &gt; 0： 发送信号给<strong>进程</strong>标识为pid的进程</li>
<li>pid = 0： 发送信号给当前进程<strong>相同进程组</strong>的所有进程</li>
<li>pid = -1：发送信号给<strong>系统内除了1号进程以外</strong>的所有进程</li>
<li>pid &lt; -1：发送信号给<strong>进程组</strong>标识为-pid的进程。</li>
</ul>
<p>当sig=0时没有信号发出，但是系统会执行错误检查，通常会利用sig值为0来检查某个进程是否在执行。</p>
<p>###Example<br>相关知识：WIFSIGNALED和WIFEXITED两个宏是用来判断当前程序的子进程的退出方式，是接收到信号异常退出<br>还是正常调用exit()或return退出。</p>
<ul>
<li>WIFEXITED: 调用exit()或return退出</li>
<li>WIFSIGNALED:接收到信号异常退出 此时可以使用WTERMSIG(status)获取其接受信号的内容。</li>
</ul>
<figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;unistd.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;signal.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;sys/types.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;sys/wait.h&gt;</span></span></div><div class="line">main()</div><div class="line">&#123;</div><div class="line">    <span class="keyword">pid_t</span> pid;</div><div class="line">    <span class="keyword">int</span> status;</div><div class="line">    <span class="keyword">if</span>(!(pid= fork()))</div><div class="line">    &#123;</div><div class="line">        <span class="built_in">printf</span>(<span class="string">"Hi I am child process!\n"</span>);</div><div class="line">        sleep(<span class="number">10</span>);</div><div class="line">        <span class="keyword">return</span>;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">else</span></div><div class="line">    &#123;</div><div class="line">        <span class="built_in">printf</span>(<span class="string">"send signal to child process (%d) \n"</span>, pid);</div><div class="line">        sleep(<span class="number">1</span>);</div><div class="line">        kill(pid, SIGABRT);</div><div class="line">        wait(&amp;status);</div><div class="line">        <span class="keyword">if</span>(WIFSIGNALED(status))</div><div class="line">            <span class="built_in">printf</span>(<span class="string">"chile process receive signal %d\n"</span>, WTERMSIG(status));</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="wait-与waitpid"><a href="#wait-与waitpid" class="headerlink" title="wait()与waitpid()"></a>wait()与waitpid()</h2><p>###头文件<br>sys/wait.h</p>
<p>###函数原型<br>pid_t wait(int<em> status);<br>pid_t waitpid(pid_t pid, int</em> status, int options);</p>
<h3 id="函数说明"><a href="#函数说明" class="headerlink" title="函数说明"></a>函数说明</h3><p>父进程创建子进程之后，父进程使用wait和waitpid具有监视子进程的运行状态的能力。这两个函数用于<strong>等待子进程的状态发生变化回调并且获取状态发生变化的信息</strong>，所能获取的状态变化包括：<strong>子进程运行结束,子进程被信号量暂停，子进程被信号量回复运行</strong>。</p>
<p>父进程执行wait函数之后，父进程会被阻塞在此处，如果子进程状态发生变化，则wait函数会立即返回结果；否则wait函数会一直阻塞直到子进程状态发生变化。</p>
<p>通常意义上，，如果子进程状态发生了变化，但是还是未被其父进程或者其他系统回调执行wait函数，此时的子进程被称为可等待的。</p>
<p>子进程运行结束后父进程执行wait函数可以推动系统释放与子进程相关的资源；否则子进程将会被维持在<strong>僵尸进程</strong>（子进程已结束，而父进程还在运行）的状态下一直存在。</p>
<h3 id="参数说明-1"><a href="#参数说明-1" class="headerlink" title="参数说明"></a>参数说明</h3><ul>
<li>pid：要监听的进程的ID(&lt;-1, =-1, =0, &gt; 0)</li>
<li>status: 用于存储出发状态变化时的信号值和exit(code)中的code值。</li>
<li>options 提供一些额外的选项控制waitpid,目前linux中只支持WNOHANG和WUNTRACED两个选项，这是两个常数宏，可以使用|连接使用.</li>
</ul>
<p><strong>pid详细说明</strong>:</p>
<ul>
<li>pid &lt; -1 : 监听范围为进程组为-pid的所有子进程</li>
<li>pid = -1 : 监听范围为调用wait/waitpid的所有子进程</li>
<li>pid = 0: 监听范围为子进程的进程组ID（与父进程相等）</li>
<li>pid &gt; 0: 监听特定pid的进程</li>
</ul>
<p><strong>status详细说明</strong></p>
<p>status用于保存出发wait的信号值或者退出时exit(code)中的code值</p>
<p><strong>options详细说明</strong></p>
<ul>
<li>WNOHANG : 使用此参数调用waitpid,即使子进程没有退出，他也会立即返回，而不是像wait一直等下去</li>
<li>WUNTRACED : 用于调试，极少用</li>
</ul>
<p>一般情况下使用值为0即可。</p>
<h3 id="wait与waitpid关系"><a href="#wait与waitpid关系" class="headerlink" title="wait与waitpid关系"></a>wait与waitpid关系</h3><p>wait实质上是waitpid中pid=-1,options=0时封装，即</p>
<p>wait(&amp;status)与waitpid(-1, &amp;status, 0)完全相同</p>
<p>###相关宏</p>
<p>wait.h中定义了一些宏用于解析status的值：</p>
<table>
<thead>
<tr>
<th style="text-align:center">宏</th>
<th>含义</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">WIFEXITED(status)</td>
<td>子进程正常退出返回true否则false</td>
</tr>
<tr>
<td style="text-align:center">WEXITSTATUS(status)</td>
<td>当正常退出时，返回exit(code)中的code</td>
</tr>
<tr>
<td style="text-align:center">WIFSIGNALED</td>
<td>子进程接受信号退出时返回true，否则false</td>
</tr>
<tr>
<td style="text-align:center">WTERMSIG</td>
<td>被信号量杀死时，返回信号量的值</td>
</tr>
<tr>
<td style="text-align:center">WIFSTOPED(status)</td>
<td>当子进程被信号量暂停时返回true</td>
</tr>
<tr>
<td style="text-align:center">WSTOPSIG(status)</td>
<td>被信号量暂停时信号量的值</td>
</tr>
</tbody>
</table>
<p><strong>options值</strong>:</p>
<table>
<thead>
<tr>
<th style="text-align:center">常亮</th>
<th>含义</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">WNOHANG</td>
<td>调用wait时制定pid仍未返回，wait立即返回0，用于判断子进程有没有结束</td>
</tr>
<tr>
<td style="text-align:center">WUNTRACED</td>
<td>当子进程被暂停时，则wait立即返回子进程的pid</td>
</tr>
<tr>
<td style="text-align:center">WCONTINUED</td>
<td>当被暂停的子进程又被信号量恢复后，则wait立即返回子进程的pid。Linux 2.6.10及以后生效。在Mac 0S X 10.9.5上未生效。</td>
</tr>
</tbody>
</table>

                    
                        
                    
                    
                        <p>
                            <a href="/2017/05/04/Wait函数详解/#post-footer" class="postShorten-excerpt_link link">
                                Comment and share
                            </a>
                        </p>
                    
                </div>
            
        </div>
        
    </article>
    
    
    <article class="postShorten postShorten--thumbnailimg-bottom" itemscope itemType="http://schema.org/BlogPosting">
        <div class="postShorten-wrap">
            
            <div class="postShorten-header">
                <h1 class="postShorten-title" itemprop="headline">
                    
                        <a class="link-unstyled" href="/2017/05/01/Linux用于IO的数据结构及fcntl函数详解/">
                            Linux用于IO的数据结构及fcntl函数详解
                        </a>
                    
                </h1>
                <div class="postShorten-meta">
    <time itemprop="datePublished" datetime="2017-05-01T23:31:31+08:00">
	
		    5月 01, 2017
    	
    </time>
    
        <span>in </span>
        
    <a class="category-link" href="/categories/Linux环境高级编程/">Linux环境高级编程</a>


    
</div>

            </div>
            
                <div class="postShorten-content" itemprop="articleBody">
                    <h1 id="Linux用于I-O的数据结构及fcntl函数详解"><a href="#Linux用于I-O的数据结构及fcntl函数详解" class="headerlink" title="Linux用于I/O的数据结构及fcntl函数详解"></a>Linux用于I/O的数据结构及fcntl函数详解</h1><h2 id="Linux内核用于IO的数据结构"><a href="#Linux内核用于IO的数据结构" class="headerlink" title="Linux内核用于IO的数据结构"></a>Linux内核用于IO的数据结构</h2><p>内核使用<strong>三种数据结构</strong>表示打开的文件，它们之间的关系决定了在文件共享方面一个进程对另一个进程可能产生的影响.</p>
<ul>
<li>进程表项 每个进程在记录表中都有一个记录项，记录项中包含一张打开的文件描述符表，可将其视为一个矢量，每个描述符占用一项。与每个文件描述符相关联的是：<ul>
<li>文件描述符标志(close_on_exec,close_on_exec是一个进程所有文件描述符的标记位图，每个比特位代表一个打开的文件描述符，用于确定在系统调用execve()时需要关闭的文件句柄)。</li>
<li>指向一个文件表项的指针</li>
</ul>
</li>
<li>文件表项 内核为所有打开文件维护一张文件表（<strong>不同进程打开相同文件将有两条记录</strong>），每个文件表项中包括：<ul>
<li>文件状态标志(read,write,append,async,nonblock等)</li>
<li>当前文件偏移量</li>
<li>指向该文件v(i)节点表项的指针</li>
</ul>
</li>
<li>节点表项。每个打开的文件都有一个v-node结构，v-node中包含了文件类型和对此文件进行各种操作函数的指针。对于大多数文件，V-node中还包含了文件inode节点信息，这些信息是打开文件时从磁盘上读入内存的，所以文件所有信息都是随时可用的。<ul>
<li>v节点的信息</li>
<li>当前文件的长度</li>
<li>i节点的信息</li>
</ul>
</li>
</ul>
<blockquote>
<p>close_on_exec是一个进程所有文件描述符（文件句柄）的位图标志，<strong>每个bit代表一个打开的文件描述符，用于<br>确定在系统调用execve()时是否需要关闭文件句柄。</strong>当一个进程fork出一个子进程时，通常会在子进程中调用execve()函数<br>加载执行另一个新程序。此时子进程将完全被新程序替换掉，并在子进程中执行新程序。若一个文件描述符在close_on_exec中对应的<br>bit被设置，那么在执行execve()时该文件描述符将被关闭，否则该文件描述符将始终处于打开状态。<br>当打开一个文件的时候，默认情况下文件句柄在子进程中也处于打开状态。<br>注意文件描述符和文件描述符标志的区别，文件描述符是文件进程打开文件时的文件句柄，文件描述符标志为close_on_exec。</p>
</blockquote>
<p>下图显示了一个进程打开两个不同文件时三张表对应的关系：</p>
<p><img src="../assets/images/singleProcessmultifile.png" alt=""></p>
<p>如果两个独立的进程同时打开同一个文件，三张表之间的对应关系如下：</p>
<p><img src="../assets/images/multiProcesssinglefile.png" alt=""><br>从上面可以看出，不同进程打开相同的文件时每个进程将获得各自的文件表项，这是因为不同的进程都有各自的文件偏移量。<br>当我们对文件进行操作的时候，上面三种表项之间的变化关系如下：</p>
<ul>
<li>当对文件进行写操作时（write），在文件表项中的文件偏移量将增加写入的字节数。如果此时文件偏移量超过了文件长度，更新文件长度为当前的文件偏移量</li>
<li>当用O_APPEND标志打开一个文件，则相应的标志也被设置到文件表项的文件标志状态中。每次对这种具有追加标志的文件进行写操作时，<strong>首先将当前文件偏移量设置为文件文件长度</strong>，这就使得每次增加的内容都会写到文件末尾。</li>
<li>若使用lseek定位到文件末尾，则文件表项中偏移量被设置为文件长度</li>
<li>lseek函数只修改文件表项中的偏移量，不进行任何IO操作。</li>
</ul>
<p><strong>注意问题：</strong></p>
<ul>
<li>可能有多个文件描述符指向同一个文件表项，如在fork的时候就有可能发生</li>
<li>注意文件描述符和文件状态标志在作用范围方面的区别。前者只用于一个进程的描述符，而后者则应用于指向该给定文件表项的任何进程中的所有描述符。</li>
</ul>
<h2 id="函数fcntl功能及用法"><a href="#函数fcntl功能及用法" class="headerlink" title="函数fcntl功能及用法"></a>函数fcntl功能及用法</h2><p><strong>函数原型</strong>:</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;fcntl.h&gt;</span></span></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">fcntl</span><span class="params">(<span class="keyword">int</span> fd, <span class="keyword">int</span> cmd, ...<span class="comment">/*int args or lock args*/</span>)</span></span>;</div></pre></td></tr></table></figure>
<p><strong>函数功能</strong>:<br>fcntl的作用是改变已经打开的文件属性。</p>
<p><strong>参数说明</strong>:</p>
<ul>
<li>fd 为file descriptor,即文件打开之后的文件描述符</li>
<li>cmd为命令，即需要对fd操作的命令,一般为几个宏定义中的其中一个</li>
<li>args 参数，此参数为执行cmd命令所需要的参数</li>
</ul>
<p><strong>cmd参数命令及功能</strong>:</p>
<p>fcntl的功能可以分为5种:</p>
<ul>
<li>复制一个已有的文件描述符<ul>
<li>cmd = F_DUPFD，此功能<strong>返回一个文件描述符，新的描述符的值为大于或等于args的可用的<br>（尚未打开）文件描述符的最小值，新描述符与fd共用一个文件表项</strong>。但是新的文件描述符有<br> 它自己的一套文件描述符标志.</li>
<li>cmd = F_DUPFD_CLOEXEC.与上述功能一致，唯一不同的是使用此命令会设置CLOSE_ON_EXEC，<br>即当执行execve的时候，文件描述符将被关闭。</li>
</ul>
</li>
<li>获取或设置文件描述符标志<ul>
<li>cmd = F_GETFD <strong>返回与fd关联的close_on_exec标志</strong>，第三个参数被忽略。</li>
<li>cnd = F_SETFD <strong>将文件描述符标志close_on_exec设置为第三个参数</strong>。</li>
</ul>
</li>
<li>获取或设置文件状态标志<ul>
<li>cmd = F_GETFL <strong>获取fd对应的文件的状态标志（存储于文件表项）</strong></li>
<li>cmd = F_SETFL <strong>设置fd对应文件的状态标志</strong></li>
</ul>
</li>
<li>获取或设置异步IO所有权<ul>
<li>cmd = F_GETOWN 获取当前接受SIGIO和SIGURG信号的进程IO或者进程组ID。</li>
<li>cmd = F_SETOWN 设置接受SIGIO和SIGURG信号的进程ID或进程组ID。返回值为正则为进程，返回值为负数即为进程组。</li>
</ul>
</li>
<li>获取或记录锁（cmd=F_GETLK、F_SETLK、F_SETLKW），此处不详解</li>
</ul>
<p><strong>文件状态标志说明</strong>：</p>
<p>文件状态标志存储与文件表项中，它用于说明进程对当前文件的可操作权限。文件的<br>操作权限说明如下图表所示，权限设置可使用|或者&amp;进行设置.</p>
<table>
<thead>
<tr>
<th style="text-align:center">文件状态标志</th>
<th style="text-align:left">功能说明</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">O_RDONLY</td>
<td style="text-align:left">只读权限</td>
</tr>
<tr>
<td style="text-align:center">O_WRONLY</td>
<td style="text-align:left">只写权限</td>
</tr>
<tr>
<td style="text-align:center">O_RDWR</td>
<td style="text-align:left">读写权限</td>
</tr>
<tr>
<td style="text-align:center">O_EXEC</td>
<td style="text-align:left">可执行权限</td>
</tr>
<tr>
<td style="text-align:center">O_SEARCH</td>
<td style="text-align:left">只搜索打开权限</td>
</tr>
<tr>
<td style="text-align:center">O_APPEND</td>
<td style="text-align:left">追加写</td>
</tr>
<tr>
<td style="text-align:center">O_NONBLOCK</td>
<td style="text-align:left">非阻塞模式</td>
</tr>
<tr>
<td style="text-align:center">O_SYNC</td>
<td style="text-align:left">等待写完成（数据和属性）</td>
</tr>
<tr>
<td style="text-align:center">O_DSYNC</td>
<td style="text-align:left">等待写完成（仅数据）</td>
</tr>
<tr>
<td style="text-align:center">O_RSYNC</td>
<td style="text-align:left">同步读写</td>
</tr>
<tr>
<td style="text-align:center">O_FSYNC</td>
<td style="text-align:left">等待写完成</td>
</tr>
<tr>
<td style="text-align:center">O_ASYNC</td>
<td style="text-align:left">异步IO</td>
</tr>
</tbody>
</table>
<blockquote>
<p>注意O_RDONLY、O_WRONLY、O_RDWR、O_EXEC、O_SEARCH这个五个标志并不各占<br>一位，一个文件的访问方式只能取这五个里面的一个。因此检查当前文件的是这<br>五个标志中的哪一个需要使用屏蔽字O_ACCMODE取得当问方式位，在于这五个标志<br>进行对比。</p>
</blockquote>
<p><strong>代码示例说明</strong><br><figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;fcntl.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;unistd.h&gt;</span></span></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</div><div class="line">  <span class="keyword">int</span> test;</div><div class="line">  <span class="comment">//返回结果：test = 10，返回大于等于第三个参数可用的fd(10)。</span></div><div class="line">  test = fcntl(STDIN_FILENO, F_DUPFD, <span class="number">10</span>);</div><div class="line">  <span class="built_in">printf</span>(<span class="string">"result of fcntl(STDIN_FILENO, F_DUPFD, 10) is:%d\n"</span>, test);</div><div class="line"></div><div class="line">  <span class="comment">//返回结果：test=11,与上一个函数功能相同</span></div><div class="line">  <span class="comment">//不同之处在于其设置了close_on_exec,当执行exec时关闭响应的文件描述符</span></div><div class="line">  <span class="comment">//注意有一些版本的系统上没有定义这个宏</span></div><div class="line">  <span class="comment">//test = fcntl(STDIN_FILENO, F_DUPFD_CLOEXEC, 10);</span></div><div class="line"></div><div class="line">  <span class="comment">//返回结果 test = 0. 标准输入的文件描述符标志(即关闭标志)为0，</span></div><div class="line">  <span class="comment">//意思是执行exec时关联的文件描述符不关闭</span></div><div class="line">  test = fcntl(STDIN_FILENO, F_GETFD);</div><div class="line">  <span class="built_in">printf</span>(<span class="string">"the result of fcntl(STDIN_FILENO, F_GETFD) is:%d\n"</span>, test);</div><div class="line"></div><div class="line">  <span class="comment">//将文件描述符标志设置为0</span></div><div class="line">  fcntl(STDIN_FILENO, F_SETFD, <span class="number">0</span>);</div><div class="line"></div><div class="line">  <span class="comment">//返回结果 test = 32270</span></div><div class="line">  test = fcntl(STDIN_FILENO, F_GETFL);</div><div class="line">  <span class="built_in">printf</span>(<span class="string">"the result of fcntl(STDIN_FILENO, F_GETFL) is:%d\n"</span>, test);</div><div class="line"></div><div class="line">  <span class="comment">//给STDIN_FILENO对应的IO添加非阻塞权限</span></div><div class="line">  test |= O_NONBLOCK;</div><div class="line">  fcntl(STDIN_FILENO, F_SETFL, test);</div><div class="line"></div><div class="line">  test = fcntl(STDIN_FILENO, F_GETFL);</div><div class="line">  <span class="built_in">printf</span>(<span class="string">"the result of fcntl(STDIN_FILENO, F_GETFL) is:%d\n"</span>, test);</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h2 id="STDIN-FILENO，STDOUT-FILENO以及STDERR-FILENO"><a href="#STDIN-FILENO，STDOUT-FILENO以及STDERR-FILENO" class="headerlink" title="STDIN_FILENO，STDOUT_FILENO以及STDERR_FILENO"></a>STDIN_FILENO，STDOUT_FILENO以及STDERR_FILENO</h2><p>STDIN_FILENO等是系统API接口库中<unistd.h>的宏定义，它是一个int类型的值，是打开文件的句柄，<br>对应的主要函数有open,read,write和close等。<br>STDIN_FILENO的含义是标准输入（键盘）的文件描述符，STDOUT_FILENO是标准输出流的文件描述符，STDERR_FILENO<br>是标准错误流的文件描述符。</unistd.h></p>
<h3 id="STDIN-FILENO与stdin的区别"><a href="#STDIN-FILENO与stdin的区别" class="headerlink" title="STDIN_FILENO与stdin的区别"></a>STDIN_FILENO与stdin的区别</h3><ul>
<li>数据类型不同 stdin的数据类型为FILE*，STDIN_NO的数据类型为int</li>
<li>可用的函数不同 stdin主要用的函数有fread,fwrite,fclose，STDIN_FILENO可用的函数为write，read和close</li>
<li>stdin属于标准IO，高级的输入输出函数，在stdio.h中定义;STDIN_FILENO是文件描述符，一般定义为0,1,2,属于没有buffer的IO,直接调用系统调用，定义在unistd.h中</li>
<li>层次不同，stdin属于标注库处理的输入流，其声明为FILE*型，对应的函数前面都有f开头；而STDIN_FILENO属于系统API接口，对用的函数是一些系统级的调用</li>
</ul>

                    
                        
                    
                    
                        <p>
                            <a href="/2017/05/01/Linux用于IO的数据结构及fcntl函数详解/#post-footer" class="postShorten-excerpt_link link">
                                Comment and share
                            </a>
                        </p>
                    
                </div>
            
        </div>
        
    </article>
    
    
    <article class="postShorten postShorten--thumbnailimg-bottom" itemscope itemType="http://schema.org/BlogPosting">
        <div class="postShorten-wrap">
            
            <div class="postShorten-header">
                <h1 class="postShorten-title" itemprop="headline">
                    
                        <a class="link-unstyled" href="/2017/04/07/free如何知道要free多大的空间/">
                            C语言free如何知道要free多大的空间
                        </a>
                    
                </h1>
                <div class="postShorten-meta">
    <time itemprop="datePublished" datetime="2017-04-07T10:50:31+08:00">
	
		    4月 07, 2017
    	
    </time>
    
        <span>in </span>
        
    <a class="category-link" href="/categories/C-学习/">C++学习</a>


    
</div>

            </div>
            
                <div class="postShorten-content" itemprop="articleBody">
                    <p>在C语言中，当向一个函数传递指针的时候，它的长度信息往往会被截断（如果是数组名），传入函数的只是一个指针，而无法标示数组的长度，在函数中我们也无法获取它的长度信息，除非显示的传递一个长度参数。但是使用free函数的过程中，我们只是向free中传递了一个指针，并没有标示它的大小，那free是如何知道将要被free掉的内存的大小呢？下面将详细解答这一问题。</p>
<p>malloc函数的实现是以块分配内存，在被分配的块中包括两部分。<strong>第一部分中存储含有报头的元数据，它其中包含有分配块的大小信息，是一个常量；第二部分中存储实际用户数据</strong>。而使用malloc分配内存返回的是第二部分用户数据的地址。而块的两个部分在内存中的存储取决有编译器的实现，一般有两种情况，第一种是最常见的，即元数据和用户数据是连续的，存储在连续空间位置。第二种是两部分分开存储。</p>
<p>对于第一种情况，malloc分配内存的空间图如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">____ The allocated block ____</div><div class="line">/                             \</div><div class="line">+--------+--------------------+</div><div class="line">| Header | Your data area ... |</div><div class="line">+--------+--------------------+</div><div class="line">         ^</div><div class="line">         |</div><div class="line">         +-- The address you are given</div></pre></td></tr></table></figure>
<p>对于上述情况，malloc中内存转换实现方式为：<br><figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/* The corresponding word size */</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> SIZE_SZ                (sizeof(INTERNAL_SIZE_T))</span></div><div class="line">...</div><div class="line"><span class="comment">/* conversion from malloc headers to user pointers, and back */</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> chunk2mem(p) ((void*)((char*)(p) + 2*SIZE_SZ))</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> mem2chunk(mem) ((mchunkptr)((char*)(mem) - 2*SIZE_SZ))</span></div></pre></td></tr></table></figure></p>
<p>如上源码我们可以看出来，chunk2mem将原始指针转换为user_data的指针，mem2chunk做了相反的转换。这个时候free的实现为：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">free</span><span class="params">(<span class="keyword">void</span>* mem)</span> </span>&#123;</div><div class="line">  p = mem2chunk(mem);</div><div class="line">  <span class="comment">// Now that you know how large is chunk "p", go ahead and free the chunk.</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>同时，我们通过实验可以推测，标准库对void*的operator=做了重载。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">#include &lt;iostream&gt;</div><div class="line"></div><div class="line">int main() &#123;</div><div class="line">  int *a = (int*)malloc(sizeof(int));</div><div class="line">  int *b = (int*)malloc(sizeof(int));</div><div class="line">  short *c = (short*)malloc(sizeof(short));</div><div class="line">  std::cout &lt;&lt; a &lt;&lt; std::endl</div><div class="line">            &lt;&lt; b &lt;&lt; std::endl</div><div class="line">            &lt;&lt; c &lt;&lt; std::endl;</div><div class="line">  std::cout &lt;&lt; b - a &lt;&lt; std::endl;</div><div class="line">  std::cout &lt;&lt; reinterpret_cast&lt;size_t&gt;(b) - reinterpret_cast&lt;size_t&gt;(a) &lt;&lt; std::endl;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>输出结果为:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">0x10b5c20</div><div class="line">0x10b5c40</div><div class="line">0x10b5c60</div><div class="line">8</div><div class="line">32</div></pre></td></tr></table></figure></p>
<p>参考:</p>
<p><a href="https://www.quora.com/How-does-free-function-in-C-knows-how-much-memory-to-be-released-deallocate" target="_blank" rel="external">https://www.quora.com/How-does-free-function-in-C-knows-how-much-memory-to-be-released-deallocate</a></p>
<p><a href="http://stackoverflow.com/questions/1518711/how-does-free-know-how-much-to-free" target="_blank" rel="external">http://stackoverflow.com/questions/1518711/how-does-free-know-how-much-to-free</a></p>

                    
                        
                    
                    
                        <p>
                            <a href="/2017/04/07/free如何知道要free多大的空间/#post-footer" class="postShorten-excerpt_link link">
                                Comment and share
                            </a>
                        </p>
                    
                </div>
            
        </div>
        
    </article>
    
    
    <article class="postShorten postShorten--thumbnailimg-bottom" itemscope itemType="http://schema.org/BlogPosting">
        <div class="postShorten-wrap">
            
            <div class="postShorten-header">
                <h1 class="postShorten-title" itemprop="headline">
                    
                        <a class="link-unstyled" href="/2017/03/21/why-assigment-operator-can-not-be-frined-function/">
                            why assigment operator can not be frined function
                        </a>
                    
                </h1>
                <div class="postShorten-meta">
    <time itemprop="datePublished" datetime="2017-03-21T14:30:41+08:00">
	
		    3月 21, 2017
    	
    </time>
    
        <span>in </span>
        
    <a class="category-link" href="/categories/C-problems/">C++ problems</a>


    
</div>

            </div>
            
                <div class="postShorten-content" itemprop="articleBody">
                    <h1 id="why-assigment-operator-can-not-be-frined"><a href="#why-assigment-operator-can-not-be-frined" class="headerlink" title="why assigment operator can not be frined"></a>why assigment operator can not be frined</h1><blockquote>
<p>this is a problem in my work and I have find th solution on stackoverflow,so recorder here</p>
</blockquote>
<h2 id="problem-description"><a href="#problem-description" class="headerlink" title="problem description"></a>problem description</h2><p>When I refactor my object, I have a problem which need to change the return value<br>of and function std::string to a struct data, but I don’t want to change my code<br>where the function be used, so I want to overload the assignment operator which<br>will assign a struct to string.The code is as follows:</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string&gt;</span></span></div><div class="line"><span class="keyword">class</span> data_struct&#123;</div><div class="line">  <span class="keyword">friend</span> <span class="built_in">std</span>::<span class="built_in">string</span> <span class="keyword">operator</span> = (<span class="built_in">std</span>::<span class="built_in">string</span>&amp; s, data_struct&amp; d);</div><div class="line"><span class="keyword">private</span>:</div><div class="line">  <span class="keyword">bool</span> success&#123;<span class="literal">false</span>&#125;;</div><div class="line">  <span class="built_in">std</span>::<span class="built_in">string</span> message&#123;<span class="string">""</span>&#125;;</div><div class="line"><span class="keyword">public</span>:</div><div class="line">  data_struct(<span class="keyword">bool</span> t_success, <span class="built_in">std</span>::<span class="built_in">string</span> t_message):</div><div class="line">            success(t_success), message(t_message) &#123;&#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="built_in">std</span>::<span class="built_in">string</span> <span class="keyword">operator</span> = (<span class="built_in">std</span>::<span class="built_in">string</span>&amp; s, data_struct&amp; d) &#123;</div><div class="line">  s = d.s;</div><div class="line">  <span class="keyword">return</span> s;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</div><div class="line">  <span class="function">data_struct <span class="title">d</span><span class="params">(<span class="literal">false</span>,<span class="string">"haha"</span>)</span></span>;</div><div class="line">  <span class="built_in">std</span>::<span class="built_in">string</span> s = d;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>when I compile this file , this is an error follows:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">main.cpp:3:64: error: ‘std::__cxx11::string operator=(std::__cxx11::string&amp;, data_struct&amp;)’ must be a nonstatic member <span class="keyword">function</span></div><div class="line">   friend std::string operator = (std::string&amp; s, data_struct&amp; d);</div><div class="line">                                                                ^</div><div class="line">main.cpp:12:13: error: expected initializer before ‘operator’</div><div class="line"> std::string operator = (std::string&amp; s, data_struct&amp; d) &#123;</div><div class="line">             ^</div><div class="line">main.cpp: In <span class="keyword">function</span> ‘int main()’:</div><div class="line">main.cpp:19:19: error: conversion from ‘data_struct’ to non-scalar <span class="built_in">type</span> ‘std::__cxx11::string &#123;aka std::__cxx11::basic_string&lt;char&gt;&#125;’ requested</div><div class="line">   std::string s = d;</div></pre></td></tr></table></figure>
<h2 id="why-does-this-happen"><a href="#why-does-this-happen" class="headerlink" title="why does this happen?"></a>why does this happen?</h2><p>Firstly, it should be noted that this has nothing to do with the operator being implemented as a friend specifically. It is really about implementing the copy-assignment as a member function or as a non-member (standalone) function. Whether that standalone function is going to be a friend or not is completely irrelevant: it might be, it might not be, depending on what it wants to access inside the class.</p>
<p>Now, the answer to this question is given in D&amp;E book (The Design and Evolution of C++). The reason for this is that the compiler always declares/defines a member copy-assignment operator for the class (if you don’t declare your own member copy-assignment operator).</p>
<p>If the language also allowed declaring copy-assignment operator as a standalone (non-member) function, you could end up with the following</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// Class definition</span></div><div class="line"><span class="keyword">class</span> SomeClass &#123;</div><div class="line">  <span class="comment">// No copy-assignment operator declared here</span></div><div class="line">  <span class="comment">// so the compiler declares its own implicitly</span></div><div class="line">  ...</div><div class="line">&#125;;</div><div class="line"></div><div class="line">SomeClass a, b;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">foo</span><span class="params">()</span> </span>&#123;</div><div class="line">  a = b;</div><div class="line">  <span class="comment">// The code here will use the compiler-declared copy-assignment for `SomeClass`</span></div><div class="line">  <span class="comment">// because it doesn't know anything about any other copy-assignment operators</span></div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">// Your standalone assignment operator</span></div><div class="line">SomeClass&amp; <span class="keyword">operator</span> =(SomeClass&amp; lhs, <span class="keyword">const</span> SomeClass&amp; rhs);</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">bar</span><span class="params">()</span> </span>&#123;</div><div class="line">  a = b;</div><div class="line">  <span class="comment">// The code here will use your standalone copy-assigment for `SomeClass`</span></div><div class="line">  <span class="comment">// and not the compiler-declared one</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>As seen in the above example, the semantics of the copy-assignment would change in the middle of the translation unit - before the declaration of your standalone operator the compiler’s version is used. After the declaration your version is used. The behavior of the program will change depending on where you put the declaration of your standalone copy-assignment operator.</p>
<p>This was considered unacceptably dangerous (and it is), so C++ doesn’t allow copy-assignment operator to be declared as a standalone function.</p>
<p>It is true that in your particular example, which happens to use a friend function specifically, the operator is declared very early, inside the class definition (since that’s how friends are declared). So, in your case the compiler will, of course, know about the existence of your operator right away. However, from the point of view of C++ language the general issue is not related to friend functions in any way. From the point of view of C++ language it is about member functions vs. non-member functions, and non-member overloading of copy-assignment is just prohibited entirely for the reasons described above.</p>
<h2 id="Solution"><a href="#Solution" class="headerlink" title="Solution"></a>Solution</h2><p>due to the solution above is not proper.So I overWrite the orignal function, and<br>invoke different version in their needed place.</p>

                    
                        
                    
                    
                        <p>
                            <a href="/2017/03/21/why-assigment-operator-can-not-be-frined-function/#post-footer" class="postShorten-excerpt_link link">
                                Comment and share
                            </a>
                        </p>
                    
                </div>
            
        </div>
        
    </article>
    
    
    <article class="postShorten postShorten--thumbnailimg-bottom" itemscope itemType="http://schema.org/BlogPosting">
        <div class="postShorten-wrap">
            
            <div class="postShorten-header">
                <h1 class="postShorten-title" itemprop="headline">
                    
                        <a class="link-unstyled" href="/2017/01/09/工厂类模式家族之简单工厂模式/">
                            工厂类模式家族之简单工厂模式
                        </a>
                    
                </h1>
                <div class="postShorten-meta">
    <time itemprop="datePublished" datetime="2017-01-09T16:57:04+08:00">
	
		    1月 09, 2017
    	
    </time>
    
        <span>in </span>
        
    <a class="category-link" href="/categories/设计模式之路/">设计模式之路</a>


    
</div>

            </div>
            
                <div class="postShorten-content" itemprop="articleBody">
                    <h1 id="工厂类模式家族之简单工厂模式"><a href="#工厂类模式家族之简单工厂模式" class="headerlink" title="工厂类模式家族之简单工厂模式"></a>工厂类模式家族之简单工厂模式</h1><p>在面向对象编程的领域，设计模式给我们提供了适合特定场景的软件设计思想，不过大多设计模式都可以通过一般的设计进行替代，但我们为什么还有费工夫去遵循设计模式呢？这就要说到设计模式的精髓了，我们通过对软件系统进行良好的设计，不但可以提高代码的可重用性，增强系统的可扩展性，给客户提供良好的接口，还可以减少编码过程中因代码组织太乱扩展过程中需要修改旧代码而带来的一连串的错误，降低维护成本。软件设计过程我们应该尽量追求符合软件设计的开闭原则。</p>
<blockquote>
<p> 开闭原则:在面向对象编程领域中，开闭原则规定“软件中的对象(类，模块，函数)应该<strong>对于扩展是开放的，但是对于修改是封闭的</strong>”。该特性在产品化的环境中是特别有价值的，在这种环境中我们认为一旦类完成，我们可以对它进行扩展改变其行为，但是不允许修改类。也就是说一个<strong>类的实现只应该因错误而修改</strong>。－－by wiki</p>
</blockquote>
<p>工厂模式家族包括三种重要的模式，分别是简单工厂模式，工厂模式以及抽象工厂模式。他们都属于类的创建型模式。创建型模式包括两种，分别是<strong>类的创建型模式</strong>和<strong>对象的创建型模式</strong>。类的创建型模式通常<strong>使用继承关系</strong>，将类的创建交由其具体的子类完成，这样就向外界隐藏了如何得到具体类的实现细节，以及这个类的实例是如何被创建或者组织在一起的。；对象创建型模式通常<strong>把一个类的创建委托给另一个对象完成</strong>，可以根据语境动态地决定生成哪个具体类的实例。</p>
<p>本节我们来讲解工厂模式中的简单工厂模式。主要包括以下几个部分：</p>
<ul>
<li>简单工厂模式的实质</li>
<li>简单工厂模式的适用性</li>
<li>简单工厂模式的结构</li>
<li>简单工厂模式的参与者</li>
<li>简单工厂模式各成分之间的交互</li>
<li>实际应用</li>
<li>简单工厂模式的优缺点</li>
<li>简单工厂模式实例代码</li>
</ul>
<h2 id="简单工厂模式的实质"><a href="#简单工厂模式的实质" class="headerlink" title="简单工厂模式的实质"></a>简单工厂模式的实质</h2><p>简单工厂模式又称为静态工厂模式。 <strong>它的实质是根据客户传递的信息，工厂类通过该信息制造出相应的产品的实例返回给客户。这样我们就做到了客户只是产品的消费者，而真正的创建者是工厂类。</strong> 在简单工厂模式中，待被创建的产品通常继承自同一个类。而这个类中包含了具体产品的所有的公共成员和方法。</p>
<h2 id="简单工厂模式的适用性"><a href="#简单工厂模式的适用性" class="headerlink" title="简单工厂模式的适用性"></a>简单工厂模式的适用性</h2><p>简单工厂模式将对象的创建和对象本身的业务分离开来，降低了系统的耦合度，当维护期间需要对客户代码或者产品代码进行修改的时候，修改其中之一不会影响另一个。</p>
<h2 id="简单工厂模式的结构"><a href="#简单工厂模式的结构" class="headerlink" title="简单工厂模式的结构"></a>简单工厂模式的结构</h2><p><img src="../assets/images/simpleFactoryclassDiagram.png" alt=""></p>
<h2 id="简单工厂模式的参与者"><a href="#简单工厂模式的参与者" class="headerlink" title="简单工厂模式的参与者"></a>简单工厂模式的参与者</h2><p>简单工厂模式中一般有以下几个部分:</p>
<ul>
<li>工厂类：简单工厂模式的核心，它的作用是根据客户提供的信息创建相应的具体产品</li>
<li>抽象产品：所有具体产品的父类，其中主要包含所有具体产品共有的方法或对象</li>
<li>具体产品：工厂类创建的具体实例。</li>
</ul>
<h2 id="简单工厂模式各成分之间的交互"><a href="#简单工厂模式各成分之间的交互" class="headerlink" title="简单工厂模式各成分之间的交互"></a>简单工厂模式各成分之间的交互</h2><p><img src="../assets/images/simplefactorysequence.png" alt=""></p>
<ul>
<li>客户首先创建factory类(一般为单例模式)，</li>
<li>factory类创建成功后，客户调用其createProduct方法，并传入相关信息，</li>
<li>具体产品实例被创建并返回给client,开始进行使用concreteProduct</li>
</ul>
<h2 id="简单工厂模式的实际应用"><a href="#简单工厂模式的实际应用" class="headerlink" title="简单工厂模式的实际应用"></a>简单工厂模式的实际应用</h2><p>在实际开发中使用简单工厂模式中，我们可以进行变通的使用。</p>
<p>在实际情况种可能会出现比较复杂的抽象产品和和具体产品之间的关系，这个时候我们依然也可以使用抽象工厂模式:</p>
<p><img src="../assets/images/simplefactory2.png" alt=""></p>
<h2 id="简单工厂模式的优缺点"><a href="#简单工厂模式的优缺点" class="headerlink" title="简单工厂模式的优缺点"></a>简单工厂模式的优缺点</h2><p>简单工厂模式的优点: 通过在中间添加一个工厂类，降低产品类和客户代码之间的耦合度；客户在获取产品的时候无需记住所有产品的构造方法，只需要通过同意的工厂类接口进行创建产品，大大提高了效率准确率。</p>
<p>简单工厂模式的缺点：所有的产品实例化的逻辑都在工厂类的一个创建方法中，当需要添加新产品的时候，不得不进行修改factory类，这样就违背了设计的开闭原则(对扩展开放，对修改封闭)；另外当产品类别过多的时候，会出现这个函数冗杂的问题，增加维护成本。最重要的是这个工厂类是所有产品的入口，当它不能工作的时候，所有的产品将陷入瘫痪状态。</p>
<h2 id="简单工厂的实例"><a href="#简单工厂的实例" class="headerlink" title="简单工厂的实例"></a>简单工厂的实例</h2><p>下面通过形状shape,circle以及rectangle来实现一个简单的简单工厂模式(如有问题，欢迎指正)：</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//factory.hpp</span></div><div class="line"><span class="meta">#<span class="meta-keyword">ifndef</span> FACTORY_HPP_</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> FACTORY_HPP_</span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"circle.hpp"</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"rectangle.hpp"</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;memory&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string&gt;</span></span></div><div class="line"><span class="keyword">class</span> Factory &#123;</div><div class="line"><span class="keyword">private</span>:</div><div class="line">  Factory() &#123;&#125;</div><div class="line">  Factory(<span class="keyword">const</span> Factory &amp;) = <span class="keyword">delete</span>;</div><div class="line">  Factory &amp;<span class="keyword">operator</span>=(<span class="keyword">const</span> Factory &amp;) = <span class="keyword">delete</span>;</div><div class="line"></div><div class="line"><span class="keyword">public</span>:</div><div class="line">  <span class="keyword">static</span> <span class="built_in">std</span>::<span class="built_in">shared_ptr</span>&lt;Factory&gt; m_factory;</div><div class="line">  <span class="keyword">static</span> <span class="built_in">std</span>::<span class="built_in">shared_ptr</span>&lt;Factory&gt; getInstance();</div><div class="line">  <span class="keyword">static</span> <span class="built_in">std</span>::<span class="built_in">shared_ptr</span>&lt;Shape&gt; getShape(<span class="keyword">const</span> <span class="built_in">std</span>::<span class="built_in">string</span> &amp;flag);</div><div class="line">&#125;;</div><div class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></div></pre></td></tr></table></figure>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//factory.cpp</span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"factory.hpp"</span></span></div><div class="line"></div><div class="line"><span class="built_in">std</span>::<span class="built_in">shared_ptr</span>&lt;Factory&gt; Factory::m_factory = <span class="literal">nullptr</span>;</div><div class="line"></div><div class="line"><span class="built_in">std</span>::<span class="built_in">shared_ptr</span>&lt;Factory&gt; Factory::getInstance() &#123;</div><div class="line">  <span class="keyword">if</span> (m_factory == <span class="literal">nullptr</span>) &#123;</div><div class="line">    m_factory = <span class="built_in">std</span>::<span class="built_in">unique_ptr</span>&lt;Factory&gt;(<span class="keyword">new</span> Factory());</div><div class="line">  &#125;</div><div class="line">  <span class="keyword">return</span> m_factory;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="built_in">std</span>::<span class="built_in">shared_ptr</span>&lt;Shape&gt; Factory::getShape(<span class="keyword">const</span> <span class="built_in">std</span>::<span class="built_in">string</span> &amp;flag) &#123;</div><div class="line">  <span class="keyword">if</span> (<span class="number">0</span> == flag.compare(<span class="string">"circle"</span>)) &#123;</div><div class="line">    <span class="keyword">return</span> <span class="built_in">std</span>::<span class="built_in">shared_ptr</span>&lt;Shape&gt;(<span class="keyword">new</span> Circle());</div><div class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="number">0</span> == flag.compare(<span class="string">"rectangle"</span>)) &#123;</div><div class="line">    <span class="keyword">return</span> <span class="built_in">std</span>::<span class="built_in">shared_ptr</span>&lt;Shape&gt;(<span class="keyword">new</span> Rectangle());</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//shape.hpp</span></div><div class="line"><span class="meta">#<span class="meta-keyword">ifndef</span> SHAPE_HPP_</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> SHAPE_HPP_</span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></div><div class="line"><span class="keyword">class</span> Shape &#123;</div><div class="line"><span class="keyword">public</span>:</div><div class="line">  <span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">draw</span><span class="params">()</span> </span>= <span class="number">0</span>;</div><div class="line">  <span class="function"><span class="keyword">virtual</span> <span class="keyword">double</span> <span class="title">getArea</span><span class="params">()</span> </span>= <span class="number">0</span>;</div><div class="line">&#125;;</div><div class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></div></pre></td></tr></table></figure>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//circle.hpp</span></div><div class="line"><span class="meta">#<span class="meta-keyword">ifndef</span> CIRCLE_HPP</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> CIRCLE_HPP</span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"shape.hpp"</span></span></div><div class="line"><span class="keyword">class</span> Circle : <span class="keyword">public</span> Shape &#123;</div><div class="line"><span class="keyword">public</span>:</div><div class="line">  Circle(<span class="keyword">double</span> t_radius = <span class="number">0</span>) : m_radius(t_radius) &#123;&#125;</div><div class="line">  <span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">draw</span><span class="params">()</span> </span>&#123;</div><div class="line">    <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">"this is a circle, the radius is : "</span> &lt;&lt; m_radius &lt;&lt; <span class="built_in">std</span>::<span class="built_in">endl</span>;</div><div class="line">  &#125;;</div><div class="line">  <span class="function"><span class="keyword">virtual</span> <span class="keyword">double</span> <span class="title">getArea</span><span class="params">()</span> </span>&#123; <span class="keyword">return</span> m_radius * m_radius * <span class="number">3.14</span>; &#125;</div><div class="line"></div><div class="line"><span class="keyword">private</span>:</div><div class="line">  <span class="keyword">double</span> m_radius;</div><div class="line">&#125;;</div><div class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></div></pre></td></tr></table></figure>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//rectangle.hpp</span></div><div class="line"><span class="meta">#<span class="meta-keyword">ifndef</span> RECTANGLE_HPP_</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> RECTANGLE_HPP_</span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"shape.hpp"</span></span></div><div class="line"><span class="keyword">class</span> Rectangle : <span class="keyword">public</span> Shape &#123;</div><div class="line"><span class="keyword">public</span>:</div><div class="line">  Rectangle(<span class="keyword">int</span> a = <span class="number">0</span>, <span class="keyword">int</span> b = <span class="number">0</span>) : m_height(a), m_width(b) &#123;&#125;</div><div class="line">  <span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">draw</span><span class="params">()</span> </span>&#123;</div><div class="line">    <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">"this is a rectangle\n height: "</span> &lt;&lt; m_height</div><div class="line">              &lt;&lt; <span class="string">"\nwidth:"</span> &lt;&lt; m_width &lt;&lt; <span class="built_in">std</span>::<span class="built_in">endl</span>;</div><div class="line">  &#125;</div><div class="line">  <span class="function"><span class="keyword">virtual</span> <span class="keyword">double</span> <span class="title">getArea</span><span class="params">()</span> </span>&#123; <span class="keyword">return</span> m_height * m_width; &#125;</div><div class="line"></div><div class="line"><span class="keyword">private</span>:</div><div class="line">  <span class="keyword">int</span> m_height;</div><div class="line">  <span class="keyword">int</span> m_width;</div><div class="line">&#125;;</div><div class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></div></pre></td></tr></table></figure>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//main.cpp</span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"circle.hpp"</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"factory.hpp"</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"rectangle.hpp"</span></span></div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</div><div class="line">  <span class="built_in">std</span>::<span class="built_in">shared_ptr</span>&lt;Factory&gt; t = Factory::getInstance();</div><div class="line">  <span class="built_in">std</span>::<span class="built_in">shared_ptr</span>&lt;Shape&gt; c = t-&gt;getShape(<span class="string">"circle"</span>);</div><div class="line">  c-&gt;draw();</div><div class="line">  <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">"the area is: "</span> &lt;&lt; c-&gt;getArea() &lt;&lt; <span class="built_in">std</span>::<span class="built_in">endl</span>;</div><div class="line">  <span class="built_in">std</span>::<span class="built_in">shared_ptr</span>&lt;Shape&gt; r = t-&gt;getShape(<span class="string">"rectangle"</span>);</div><div class="line">  r-&gt;draw();</div><div class="line">  <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">"the area is :"</span> &lt;&lt; r-&gt;getArea() &lt;&lt; <span class="built_in">std</span>::<span class="built_in">endl</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>

                    
                        
                    
                    
                        <p>
                            <a href="/2017/01/09/工厂类模式家族之简单工厂模式/#post-footer" class="postShorten-excerpt_link link">
                                Comment and share
                            </a>
                        </p>
                    
                </div>
            
        </div>
        
    </article>
    
    
    <article class="postShorten postShorten--thumbnailimg-bottom" itemscope itemType="http://schema.org/BlogPosting">
        <div class="postShorten-wrap">
            
            <div class="postShorten-header">
                <h1 class="postShorten-title" itemprop="headline">
                    
                        <a class="link-unstyled" href="/2017/01/08/GRASP设计原则（职责分配原则）/">
                            GRASP设计原则（职责分配原则）
                        </a>
                    
                </h1>
                <div class="postShorten-meta">
    <time itemprop="datePublished" datetime="2017-01-08T19:45:46+08:00">
	
		    1月 08, 2017
    	
    </time>
    
        <span>in </span>
        
    <a class="category-link" href="/categories/设计模式之路/">设计模式之路</a>


    
</div>

            </div>
            
                <div class="postShorten-content" itemprop="articleBody">
                    <h1 id="GRASP设计原则（职责分配原则）"><a href="#GRASP设计原则（职责分配原则）" class="headerlink" title="GRASP设计原则（职责分配原则）"></a>GRASP设计原则（职责分配原则）</h1><p>GRASP(General responsibility assignment software Principle)设计原则是设计模式的基础,在GOF的23中设计模式中处处可以体现其中的一个或多个设计原则，所以在掌握设计模式之前需要对GRASP原则有一定的了解，本节我在这里总结一下grasp原则。</p>
<p>本文共分为以下几个内容：</p>
<ul>
<li>GRASP的九个原则</li>
<li>GRASP原则详解</li>
<li>GRASP原则在23中设计模式中的体现</li>
</ul>
<h2 id="GRASP的九个原则"><a href="#GRASP的九个原则" class="headerlink" title="GRASP的九个原则"></a>GRASP的九个原则</h2><ul>
<li>信息专家原则(information)</li>
<li>创造者原则(creator)</li>
<li>低耦合原则(low coupling)</li>
<li>高内聚原则(high cohesion)</li>
<li>控制器原则(controller)</li>
<li>多态原则(polymorphism)</li>
<li>纯虚构(pure Fabrication)</li>
<li>中介原则(indirect)</li>
<li>受保护变量原则(protected Variations)</li>
</ul>
<h2 id="Grasp原则详解"><a href="#Grasp原则详解" class="headerlink" title="Grasp原则详解"></a>Grasp原则详解</h2><h3 id="信息专家原则-information-expert"><a href="#信息专家原则-information-expert" class="headerlink" title="信息专家原则(information expert)"></a>信息专家原则(information expert)</h3><p>信息专家模式的本质指的是我们应该将<strong>职责委托给哪一个对象</strong>，这个职责可以是一个方法，也可以是一个算法或者其他内容。它是面向过程设计过程中最基本的原则。</p>
<p><strong>委托原则</strong>:我们在设计对象的时候，如果某个对象拥有完成某个职责所需要的所有信息，那么这个职责就分配给这个对象实现。这个时候，这个类就是相对于这个职责的信息专家。</p>
<p>示例：我们在设计购物网站的时候，为避免重复，一种商品只能在购物车中出现一次，如果多次出现，则需要将其数量增加。这个时候我们在将物品放入购物车的时候，要首先判断当前物品是否在购物车中，判断两个物品是否为同一个物品的方法这个职责应该委托给谁呢？显而易见，商品类中有唯一标识，所以这个职责由商品类实现，而不是购物车。</p>
<h3 id="创造者原则-creator"><a href="#创造者原则-creator" class="headerlink" title="创造者原则(creator)"></a>创造者原则(creator)</h3><p>creator原则的本质是创建类对象职责应该委托给那个对象，也就是谁应该负责产生某个类的实例。</p>
<p>解决方案:　如果符合下面的一个或者多个条件，则可以将创建A的实例的职责分配给B;</p>
<ul>
<li>B包含A</li>
<li>B聚合A</li>
<li>B拥有初始化A的数据并在创建A的实例时将数据传递给A</li>
<li>B记录A的实例</li>
<li>B频发使用A</li>
</ul>
<p>满足上述一种或者多种情况的时候，我们应该奖创建A的实例的职责分配给B。</p>
<p>合理的creator原则带来的<strong>优点</strong>：如果职责分配合理，设计就能降低耦合，提高设计的清晰度，封装性和重用性。</p>
<p>示例:例如订单和商品的关系是聚合关系，这个时候我们将在订单中创建商品。</p>
<h3 id="低耦合-Low-coupling"><a href="#低耦合-Low-coupling" class="headerlink" title="低耦合(Low coupling)"></a>低耦合(Low coupling)</h3><p><strong>耦合是评价一个系统中各个元素之间连接或者依赖关系强弱的尺度。</strong>低耦合的原则是我们在设计系统的时候尽量降低系统中各个元素之间的耦合度，这样对于系统的理解和维护都有很大的益处。</p>
<p>耦合性高的系统会带来的坏处:</p>
<ul>
<li>一个类的修改导致其他类产生较大的影响；</li>
<li>系统难以维护和理解；</li>
<li>系统的重用性差，在重用一个高耦合类的时候，不得不重用它所依赖的所有类。</li>
</ul>
<p>两个类具有以下特性中的其中一个，我们就说这两个类是耦合的：</p>
<ul>
<li>A具有一个类型为B的属性；</li>
<li>A调用B的方法</li>
<li>A的方法包含对B的引用(参数或者返回值的方式)</li>
<li>A是B的直接或者间接的子类</li>
<li>A是接口B的一种实现</li>
</ul>
<p>低耦合系统的<strong>设计方法</strong>：</p>
<ul>
<li>在类的划分上，尽量创建松耦合的类，类之间的耦合性越低，越有利于复用，修改一个类不会影响其他类。</li>
<li>在类的设计上，尽量降低类中成员和方法的访问权限。</li>
<li>在类的设计上，尽量将类设计为不变类</li>
<li>在类的引用上，将一个对象对另一个对象的引用降低到最小</li>
</ul>
<h3 id="高内聚-high-cohesion"><a href="#高内聚-high-cohesion" class="headerlink" title="高内聚(high cohesion)"></a>高内聚(high cohesion)</h3><p><strong>内聚是评价一个对象的职责被关联的尺度或者强弱，也可以说是功能性内聚的职责。</strong>也就是功能性紧密的相关职责应该放在同一个类中，并共同完成有限的功能。这样做更加有利于对类的理解和重用，也可以降低类的维护成本。</p>
<p>往往低内聚的系统设计会导致类的混乱，当对功能进行扩展或者改进的时候带来不必要的麻烦，低内聚的类也不利于重用，因为他们的职责如此之混乱。</p>
<p>为了达到高内聚，我们需要对类的职责进行分解，使分解出来的类具有独立的职责，满足单一职责原则。<strong>将一些需要在多个类中使用到的方法封装到一个类中，其他的类只负责他们需要负责的相关功能</strong>，这样我们可以提高类的内聚程度。</p>
<h3 id="控制器原则-controller"><a href="#控制器原则-controller" class="headerlink" title="控制器原则(controller)"></a>控制器原则(controller)</h3><p>控制器模式的实质是将一些<strong>系统事件的接受和处理</strong>委托给一个的对象controller，这个对象可以是一个<strong>类，系统或者子系统</strong>，它不与UI进行交互，它只负责系统信息的接收和处理。</p>
<p>一般情况下，控制器是一个系统，这个系统中包括多个处理器，分别对应处理不同的事务。通常情况下，一个控制器应当把要完成的功能委托给其他对象，而它只负责任务的协调控制和分配。</p>
<p>控制器原则与MVC模式相对应，MVC模式是一种比设计模式更高的架构模式。</p>
<h3 id="多态原则-polymorphism"><a href="#多态原则-polymorphism" class="headerlink" title="多态原则(polymorphism)"></a>多态原则(polymorphism)</h3><p>多态原则与面向对象设计原则中的多态概念类似，这里不再详细赘述。</p>
<h3 id="纯虚构-pure-Fabrication"><a href="#纯虚构-pure-Fabrication" class="headerlink" title="纯虚构(pure Fabrication)"></a>纯虚构(pure Fabrication)</h3><p>纯虚构原则与我们所说的纯虚函数类似。</p>
<p>　　纯虚构的作用是用来解决高内聚和低耦合之间的矛盾的。高内聚低耦合是我们系统设计的终极目标，高内聚意味着我们要将类拆分成多个功能集中的类，但是拆分的多个类之间需要进行协作才能正常工作，这样又增加了类之间的耦合性。</p>
<p>　　纯虚构原则是用来解决上述问题的方案。它要求将一部分类的职责转移到纯虚构类中，在理想的情况下，分配给这种虚构类的职责是为了达到高内聚低耦合的效果。在实际的操作过程中，纯虚构类的实现又很多种方式，例如将数据库中操作的方法从数据库实体中分离出来，形成专门的数据访问类；通过对类的分解来实现类的重用，新增加的数据访问类对应于数据的持久化存储，这是软件开发过程中为了方便虚构出来的一个概念。一般情况下，<strong>纯虚构模式通常基于功能进行划分的。</strong></p>
<h3 id="中介模式-indirect"><a href="#中介模式-indirect" class="headerlink" title="中介模式(indirect)"></a>中介模式(indirect)</h3><p>中介模式的目的是为了避免两个对象之间产生直接耦合，降低对象之间的耦合度。</p>
<p>解决方案是建立中间对象来协调两个对象之间的交互，避免耦合性过高。</p>
<h3 id="受保护模式-protected-variations"><a href="#受保护模式-protected-variations" class="headerlink" title="受保护模式(protected variations)"></a>受保护模式(protected variations)</h3><p>受保护模式的实质与OCP(开放闭合原则)类似，我们首先找到系统中不稳定的变化点，使用统一的接口封装起来，如果未来发生变化的时候，可以通过扩展接口来扩展新的功能，而不需要改变旧的代码。这样达到易于扩展的目的。</p>

                    
                        
                    
                    
                        <p>
                            <a href="/2017/01/08/GRASP设计原则（职责分配原则）/#post-footer" class="postShorten-excerpt_link link">
                                Comment and share
                            </a>
                        </p>
                    
                </div>
            
        </div>
        
    </article>
    
    <div class="pagination-bar">
    <ul class="pagination">
        
        <li class="pagination-prev">
            
                <a class="btn btn--default btn--small" href="/archives/page/2/">
            
                <i class="fa fa-angle-left text-base icon-mr"></i>
                    <span>NEWER POSTS</span>
            </a>
        </li>
        
        
        <li class="pagination-next">
            <a class="btn btn--default btn--small" href="/archives/page/4/">
                    <span>OLDER POSTS</span>
                <i class="fa fa-angle-right text-base icon-ml"></i>
            </a>
        </li>
        
        <li class="pagination-number">page 3 of 5</li>
    </ul>
</div>

</section>



                <footer id="footer" class="main-content-wrap">
    <span class="copyrights">
        Copyrights &copy; 2017 魏传柳(langzi989). All Rights Reserved.
    </span>
</footer>

            </div>
            
        </div>
        


    
        
    

<div id="about">
    <div id="about-card">
        <div id="about-btn-close">
            <i class="fa fa-remove"></i>
        </div>
        
            <img id="about-card-picture" src="/assets/images/avar.jpg"/>
        
            <h4 id="about-card-name">魏传柳(langzi989)</h4>
        
            <h5 id="about-card-bio"><p>author.bio</p>
</h5>
        
        
            <h5 id="about-card-job">
                <i class="fa fa-briefcase"></i>
                <br/>
                <p>author.job</p>

            </h5>
        
        
            <h5 id="about-card-location">
                <i class="fa fa-map-marker"></i>
                <br/>
                Guangzhou,China
            </h5>
        
    </div>
</div>

        
<div id="cover" style="background-image:url('/assets/images/cover.jpg');"></div>
    </body>
    <!--SCRIPTS-->
<script src="/assets/js/script-i4qo6jx6jji9fg0dftpya6ivemizsbow4fhow76d8dwpm7m1wbvi378ssumx.min.js"></script>
<!--SCRIPTS END-->



</html>


<!DOCTYPE html>
<html lang="zh-CN">
    
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="generator" content="魏传柳">
    <title>Etiqueta: 序列化 - 魏传柳</title>
    <meta name="author" content="魏传柳(2824759538@qq.com)">
    
        <meta name="keywords" content="hexo,javascript,">
    
    
    
        <link rel="alternate" type="application/atom+xml" title="RSS" href="/atom.xml">
    
    <meta property="og:type" content="blog">
<meta property="og:title" content="魏传柳">
<meta property="og:url" content="http://yoursite.com/tags/序列化/index.html">
<meta property="og:site_name" content="魏传柳">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="魏传柳">
    
    
        
    
    
        <meta property="og:image" content="http://yoursite.com/assets/images/avar.jpg"/>
    
    
    
    
    <!--STYLES-->
    <link rel="stylesheet" href="/assets/css/style-nuvue6sithwirecbhvw3dkaobiojqvtadsnhguwi7k04xklybw5djl1smadp.min.css">
    <!--STYLES END-->
    
    
</head>

    <body>
        <div id="blog">
            <!-- Define author's picture -->


    
        
            
        
    

<header id="header" data-behavior="1">
    <i id="btn-open-sidebar" class="fa fa-lg fa-bars"></i>
    <h1 class="header-title">
        <a class="header-title-link" href="/ ">魏传柳</a>
    </h1>
    
        
            <a  class="header-right-picture "
                href="#about">
        
        
            <img class="header-picture" src="/assets/images/avar.jpg"/>
        
        </a>
    
</header>

            <!-- Define author's picture -->



        
    

<nav id="sidebar" data-behavior="1">
    
        <div class="sidebar-profile">
            <a href="/#about">
                    <img class="sidebar-profile-picture" src="/assets/images/avar.jpg"/>
            </a>
            <span class="sidebar-profile-name">魏传柳(2824759538@qq.com)</span>
        </div>
    
    
        <ul class="sidebar-buttons">
        
            <li class="sidebar-button">
                
                    <a  class="sidebar-button-link "
                         href="/ "
                        
                    >
                
                    <i class="sidebar-button-icon fa fa-lg fa-home"></i>
                    <span class="sidebar-button-desc">home</span>
                </a>
        </li>
        
            <li class="sidebar-button">
                
                    <a  class="sidebar-button-link "
                         href="/all-categories"
                        
                    >
                
                    <i class="sidebar-button-icon fa fa-lg fa-bookmark"></i>
                    <span class="sidebar-button-desc">categories</span>
                </a>
        </li>
        
            <li class="sidebar-button">
                
                    <a  class="sidebar-button-link "
                         href="/all-tags"
                        
                    >
                
                    <i class="sidebar-button-icon fa fa-lg fa-tags"></i>
                    <span class="sidebar-button-desc">tags</span>
                </a>
        </li>
        
            <li class="sidebar-button">
                
                    <a  class="sidebar-button-link "
                         href="/all-archives"
                        
                    >
                
                    <i class="sidebar-button-icon fa fa-lg fa-archive"></i>
                    <span class="sidebar-button-desc">archives</span>
                </a>
        </li>
        
            <li class="sidebar-button">
                
                    <a  class="sidebar-button-link st-search-show-outputs"
                         href="#search"
                        
                    >
                
                    <i class="sidebar-button-icon fa fa-lg fa-search"></i>
                    <span class="sidebar-button-desc">search</span>
                </a>
        </li>
        
            <li class="sidebar-button">
                
                    <a  class="sidebar-button-link "
                         href="#about"
                        
                    >
                
                    <i class="sidebar-button-icon fa fa-lg fa-question"></i>
                    <span class="sidebar-button-desc">about</span>
                </a>
        </li>
        
    </ul>
    
        <ul class="sidebar-buttons">
        
            <li class="sidebar-button">
                
                    <a  class="sidebar-button-link " href="https://github.com/langzi989" target="_blank">
                
                    <i class="sidebar-button-icon fa fa-lg fa-github"></i>
                    <span class="sidebar-button-desc">GitHub</span>
                </a>
        </li>
        
            <li class="sidebar-button">
                
                    <a  class="sidebar-button-link " href="http://blog.csdn.net/u014630623" target="_blank">
                
                    <i class="sidebar-button-icon fa fa-lg fa-csdn"></i>
                    <span class="sidebar-button-desc">CSDN</span>
                </a>
        </li>
        
    </ul>
    
        <ul class="sidebar-buttons">
        
            <li class="sidebar-button">
                
                    <a  class="sidebar-button-link "
                         href="/atom.xml"
                        
                    >
                
                    <i class="sidebar-button-icon fa fa-lg fa-rss"></i>
                    <span class="sidebar-button-desc">RSS</span>
                </a>
        </li>
        
    </ul>
    
</nav>

            
            <div id="main" data-behavior="1"
                 class="
                        hasCoverMetaIn
                        ">
                
    

<section class="postShorten-group main-content-wrap">
    
    
    <article class="postShorten postShorten--thumbnailimg-bottom" itemscope itemType="http://schema.org/BlogPosting">
        <div class="postShorten-wrap">
            
            <div class="postShorten-header">
                <h1 class="postShorten-title" itemprop="headline">
                    
                        <a class="link-unstyled" href="/2017/05/26/protobuffer学习总结/">
                            protobuffer学习总结
                        </a>
                    
                </h1>
                <div class="postShorten-meta">
    <time itemprop="datePublished" datetime="2017-05-26T19:48:59+08:00">
	
		    26 5月 2017
    	
    </time>
    
        <span>en </span>
        
    <a class="category-link" href="/categories/序列化与反序列化/">序列化与反序列化</a>


    
</div>

            </div>
            
                <div class="postShorten-content" itemprop="articleBody">
                    <h1 id="protobuffer学习总结"><a href="#protobuffer学习总结" class="headerlink" title="protobuffer学习总结"></a>protobuffer学习总结</h1><p>protobuffer是google开发的一种数据描述语言，它能够将结构化的数据序列化，并切可以将序列化的数据进行反序列化恢复原有的数据结构。一般用于数据存储以及通信协议方面。</p>
<p>如果是第一次使用protobuffer,我们可以将其与json或者xml进行类比，其实它与json或xml类似都可以作为数据的存储方式，不同的是json和xml是文本格式，而protobuffer是二进制格式。二进制格式不利于使用者直观的阅读，但是与json以及xml相比它有更多的优点。</p>
<h2 id="protoBuffer相比于xml的优点"><a href="#protoBuffer相比于xml的优点" class="headerlink" title="protoBuffer相比于xml的优点"></a>protoBuffer相比于xml的优点</h2><ul>
<li>更加简介</li>
<li>体积小：消息大小只需要xml的1/10~1/3</li>
<li>解析速度快：解析速度比xml快20~100倍</li>
<li>使用proto Buffer的编译器，可以生成方便在编程中使用的数据访问代码.</li>
<li>具有更好的兼容性，很好的支持向上或向下兼容的特性</li>
<li>提供多种序列化的出口和入口,如文件流，string流,array流等等</li>
</ul>
<h2 id="protobuffer语法"><a href="#protobuffer语法" class="headerlink" title="protobuffer语法"></a>protobuffer语法</h2><p>消息类型实例：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line">Package example;</div><div class="line"></div><div class="line">message Person&#123;</div><div class="line">  required string name = 1;</div><div class="line">  required int32 id = 2;</div><div class="line">  optional string email = 3;</div><div class="line"></div><div class="line">  enum PhoneType&#123;</div><div class="line">    mobile = 1;</div><div class="line">    home = 2;</div><div class="line">    work = 3;</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  message PhoneNumber&#123;</div><div class="line">    required string number = 1;</div><div class="line">    optional PhoneType type = 2;</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  repeated PhoneNumber phone = 4;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h3 id="指定字段规则"><a href="#指定字段规则" class="headerlink" title="指定字段规则"></a>指定字段规则</h3><p>protobuffer中字段规则包括一下三种：</p>
<ul>
<li>required：实例中必须包含的字段</li>
<li>optional：实例中可以选择性包含的字段，若实例没有指定，则为默认值，若没有设置该字段的默认值，其值是该类型的默认值。如string默认值为””，bool默认值为false,整数默认值为0。</li>
<li>repeated: 可以有多个值的字段，这类变量类似于vector，可以存储此类型的多个值。</li>
</ul>
<blockquote>
<p>由于一些历史原因，基本数值类型的repeated的字段并没有被尽可能地高效编码。在新的代码中，用户应该使用特殊选项[packed=true]来保证更高效的编码。<br>一般情况下慎重使用required字段，当此字段一定是必要的时候才使用。</p>
</blockquote>
<p>repeated使用实例：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">message Person &#123;  </div><div class="line">  required int32 age = 1;  </div><div class="line">  required string name = 2;  </div><div class="line">&#125;  </div><div class="line"></div><div class="line">message Family &#123;  </div><div class="line">  repeated Person person = 1;  </div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">char</span>* argv[])</span>  </span></div><div class="line">&#123;  </div><div class="line"></div><div class="line">    GOOGLE_PROTOBUF_VERIFY_VERSION;  </div><div class="line"></div><div class="line">    Family family;  </div><div class="line">    Person* person;  </div><div class="line"></div><div class="line">    <span class="comment">// 添加一个家庭成员，John  </span></div><div class="line">    person = family.add_person();  </div><div class="line">    person-&gt;set_age(<span class="number">25</span>);  </div><div class="line">    person-&gt;set_name(<span class="string">"John"</span>);  </div><div class="line"></div><div class="line">    <span class="comment">// 添加一个家庭成员，Lucy  </span></div><div class="line">    person = family.add_person();  </div><div class="line">    person-&gt;set_age(<span class="number">23</span>);  </div><div class="line">    person-&gt;set_name(<span class="string">"Lucy"</span>);  </div><div class="line"></div><div class="line">    <span class="comment">// 添加一个家庭成员，Tony  </span></div><div class="line">    person = family.add_person();  </div><div class="line">    person-&gt;set_age(<span class="number">2</span>);  </div><div class="line">    person-&gt;set_name(<span class="string">"Tony"</span>);  </div><div class="line"></div><div class="line">    <span class="comment">// 显示所有家庭成员  </span></div><div class="line">    <span class="keyword">int</span> size = family.person_size();  </div><div class="line"></div><div class="line">    <span class="built_in">cout</span> &lt;&lt; <span class="string">"这个家庭有 "</span> &lt;&lt; size &lt;&lt; <span class="string">" 个成员，如下："</span> &lt;&lt; <span class="built_in">endl</span>;  </div><div class="line"></div><div class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>; i&lt;size; i++)  </div><div class="line">    &#123;  </div><div class="line">        Person psn = family.person(i);  </div><div class="line">        <span class="built_in">cout</span> &lt;&lt; i+<span class="number">1</span> &lt;&lt; <span class="string">". "</span> &lt;&lt; psn.name() &lt;&lt; <span class="string">", 年龄 "</span> &lt;&lt; psn.age() &lt;&lt; <span class="built_in">endl</span>;  </div><div class="line">    &#125;  </div><div class="line"></div><div class="line">    getchar();  </div><div class="line">    <span class="keyword">return</span> <span class="number">0</span>;  </div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="数据类型"><a href="#数据类型" class="headerlink" title="数据类型"></a>数据类型</h3><p>protobuffer中的数据类型与C++数据类型之间的关联如下图：</p>
<table>
<thead>
<tr>
<th style="text-align:center">protobuffer类型</th>
<th style="text-align:center">C++类型</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">double</td>
<td style="text-align:center">double</td>
</tr>
<tr>
<td style="text-align:center">float</td>
<td style="text-align:center">float</td>
</tr>
<tr>
<td style="text-align:center">int32</td>
<td style="text-align:center">int32</td>
</tr>
<tr>
<td style="text-align:center">int64</td>
<td style="text-align:center">int64</td>
</tr>
<tr>
<td style="text-align:center">uint32</td>
<td style="text-align:center">uint32</td>
</tr>
<tr>
<td style="text-align:center">uint64</td>
<td style="text-align:center">uint64</td>
</tr>
<tr>
<td style="text-align:center">sint32</td>
<td style="text-align:center">int32</td>
</tr>
<tr>
<td style="text-align:center">sint64</td>
<td style="text-align:center">int64</td>
</tr>
<tr>
<td style="text-align:center">fixed32</td>
<td style="text-align:center">uint32</td>
</tr>
<tr>
<td style="text-align:center">fixed64</td>
<td style="text-align:center">uint64</td>
</tr>
<tr>
<td style="text-align:center">sfixed32</td>
<td style="text-align:center">uint32</td>
</tr>
<tr>
<td style="text-align:center">sfixed64</td>
<td style="text-align:center">uint64</td>
</tr>
<tr>
<td style="text-align:center">bool</td>
<td style="text-align:center">bool</td>
</tr>
<tr>
<td style="text-align:center">string</td>
<td style="text-align:center">string</td>
</tr>
<tr>
<td style="text-align:center">bytes</td>
<td style="text-align:center">string</td>
</tr>
</tbody>
</table>
<h3 id="枚举"><a href="#枚举" class="headerlink" title="枚举"></a>枚举</h3><p>当需要定义一个消息类型的时候，我们可能想为某一个字段指定预定义列表中的值。这个时候就需要用到枚举</p>
<p>如：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">message SearchRequest &#123;</div><div class="line">  required string query = 1;</div><div class="line">  optional int32 page_number = 2;</div><div class="line">  optional int32 result_per_page = 3 [default = 10];</div><div class="line">  enum Corpus &#123;</div><div class="line">    UNIVERSAL = 0;</div><div class="line">    WEB = 1;</div><div class="line">    IMAGES = 2;</div><div class="line">    LOCAL = 3;</div><div class="line">    NEWS = 4;</div><div class="line">    PRODUCTS = 5;</div><div class="line">    VIDEO = 6;</div><div class="line">  &#125;</div><div class="line">  optional Corpus corpus = 4 [default = UNIVERSAL];</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h3 id="变量标识号"><a href="#变量标识号" class="headerlink" title="变量标识号"></a>变量标识号</h3><p>在proto数据结构中，每一个变量都有唯一的数字标识。这些标识符的作用是在二进制格式中识别各个字段的，一旦开始使用就不可再改变。</p>
<blockquote>
<p>此处需要注意的是1-15之内的标号在存储的时候只占一个字节，而大于15到162047之间的需要占两个字符，所以<strong>我们尽量为频繁使用的字段分配1-15内的标识号</strong><br>。另外19000-19999之内的标识号已经被预留，不可用。最大标识号为2^29-1。</p>
</blockquote>
<h3 id="嵌套"><a href="#嵌套" class="headerlink" title="嵌套"></a>嵌套</h3><p>protobuffer中的消息可以嵌套消息，也就是在一个message中定义另一个message。如上面实例可以看出。</p>
<h3 id="扩展"><a href="#扩展" class="headerlink" title="扩展"></a>扩展</h3><p>我们可以通过扩展对proto文件进行扩展，而不需要直接区编辑原文件。</p>
<p>例如有原文件:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">message Foo&#123;</div><div class="line">  //...</div><div class="line">  extensions 100 to 199;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>上述extensions 100 to 199表示此范围内的标识号被保留为扩展用。我们在扩展文件中就可以使用这些标识号了。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">extend Foo&#123;</div><div class="line">  optional int32 bar = 126;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>上述为扩展。当用户的Foo消息被编码的时候，数据的传输格式与用户在Foo里定义新字段的效果是完全一样的。然而，要在程序代码中访问扩展字段的方法与访问普通的字段稍有不同——生成的数据访问代码为扩展准备了特殊的访问函数来访问它。例如，下面是如何在C++中设置bar的值：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">Foo foo;</div><div class="line">foo.SetExtentions(bar, 15);</div></pre></td></tr></table></figure>
<h3 id="注释"><a href="#注释" class="headerlink" title="注释"></a>注释</h3><p>与c++注释风格相同。双斜杠</p>
<h3 id="向上且向下兼容更新消息"><a href="#向上且向下兼容更新消息" class="headerlink" title="向上且向下兼容更新消息"></a>向上且向下兼容更新消息</h3><p>当在需求不断增加的过程中，数据结构也会不断变化，这个时候就需要我们去更新消息。怎么才能做到更新消息不会影响之前的数据和代码。这个时候我们更新消息需要遵循以下几个原则：</p>
<ul>
<li>不要更改任何已有的字段的数值标识</li>
<li>所添加的字段必须是optional或者repeated。</li>
</ul>
<h3 id="包名称解析"><a href="#包名称解析" class="headerlink" title="包名称解析"></a>包名称解析</h3><p>为了防止消息明明冲突，我们往往会在文件的开始出生命包，包的作用相当于命名空间。在编译成C++代码时也是namespace。例如：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">package foo.bar;</div><div class="line">message open&#123;</div><div class="line">  ///...</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>在C++对open进行访问的时候的访问方式为:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">foo::bar::open test;</div></pre></td></tr></table></figure>
<h2 id="C-程序使用protobuffer"><a href="#C-程序使用protobuffer" class="headerlink" title="C++程序使用protobuffer"></a>C++程序使用protobuffer</h2><p>按照上面的规则我们可以设计出合理的protobuffer类型。然后下一步就是将proto文件生成C++头文件和实现文件,将.proto文件编译成C接口的方法如下：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">protoc -I=SOURCE_DIR --cpp_out=DIST_DIR test.proto</div></pre></td></tr></table></figure></p>
<p>使用proto生成的头文件进行编译时需要链接protobuffer库。具体为:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">g++ main.cpp test.pb.cc -lprotobuf</div></pre></td></tr></table></figure></p>
<h2 id="protobuffer编译为C-代码的常用接口"><a href="#protobuffer编译为C-代码的常用接口" class="headerlink" title="protobuffer编译为C++代码的常用接口"></a>protobuffer编译为C++代码的常用接口</h2><p>对于C++来说，编译器会为每个.proto文件生成一个.h文件和.cc文件。.proto文件中的每一个消息对应一个类。<br>protobuffer中常用的函数：</p>
<ul>
<li>has_name()          :判断是否有当前成员</li>
<li>clear_name()        :清空该成员变量值</li>
<li>name()              :获取成员的变量值</li>
<li>set_name(string)    :设置变量值</li>
<li>set_name(const char*):设置变量值</li>
<li>set_name(int)       :设置变量值</li>
<li>clear()             :清空所有元素为空状态</li>
<li>void CopyFrom(person):从给定的对象复制。</li>
<li>mutable_name()      :获取变量name的指针</li>
<li>add_name()          :为repeated变量增加值</li>
<li>ByteSize()          :获取变量所占的字节数<br>若有元素data属性为repeated，其行为类似于vector,则此时则可用下列函数：</li>
<li>add_data()          : 添加data元素，返回值为Date*类型。</li>
<li>data_size()         : 获取repeated元素size，即元素的个数。</li>
<li>data(i)             : 获取data中地i个元素。</li>
<li>ByteSize()          : 获取序列化之后的protobuff对象的长度。</li>
<li>CopyFrom(const ProtoType&amp;): 从一个protobuf对象拷贝到另一个</li>
</ul>
<h2 id="常用的序列化方法"><a href="#常用的序列化方法" class="headerlink" title="常用的序列化方法"></a>常用的序列化方法</h2><h3 id="C数组的序列化与反序列化的API"><a href="#C数组的序列化与反序列化的API" class="headerlink" title="C数组的序列化与反序列化的API"></a>C数组的序列化与反序列化的API</h3><p>如果想将其序列为char<em>并通过socket进行传输，这是使用SerializeToArray来达到目的。<br><em>*除了下述的SerializeToArray方法之外，还有方法SerializePartialToArray，两者用法相同，其中唯一的区别在于SerializePartialToArray允许忽略required字段，而前者不允许</em></em></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">void</span>* parray = (<span class="keyword">char</span>*)<span class="built_in">malloc</span>(<span class="number">256</span>);</div><div class="line"><span class="comment">//API</span></div><div class="line"><span class="function"><span class="keyword">bool</span> <span class="title">ParseFromArray</span><span class="params">(<span class="keyword">const</span> <span class="keyword">void</span>* data, <span class="keyword">int</span> size)</span></span>;</div><div class="line"><span class="function"><span class="keyword">bool</span> <span class="title">SerializeToArray</span><span class="params">(<span class="keyword">void</span>* data. <span class="keyword">int</span> size)</span></span>;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">set_people</span><span class="params">()</span>               </span></div><div class="line">&#123;  </div><div class="line">    wp.set_name(<span class="string">"sealyao"</span>);     </div><div class="line">    wp.set_id(<span class="number">123456</span>);          </div><div class="line">    wp.set_email(<span class="string">"sealyaog@gmail.com"</span>);  </div><div class="line">    wp.SerializeToArray(parray,<span class="number">256</span>);  </div><div class="line">&#125;  </div><div class="line"></div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">get_people</span><span class="params">()</span>               </span></div><div class="line">&#123;  </div><div class="line">    rap.ParseFromArray(parray,<span class="number">256</span>);  </div><div class="line">    <span class="built_in">cout</span> &lt;&lt; <span class="string">"Get People from Array:"</span> &lt;&lt; <span class="built_in">endl</span>;  </div><div class="line">    <span class="built_in">cout</span> &lt;&lt; <span class="string">"\t Name : "</span> &lt;&lt;rap.name() &lt;&lt; <span class="built_in">endl</span>;  </div><div class="line">    <span class="built_in">cout</span> &lt;&lt; <span class="string">"\t Id : "</span> &lt;&lt; rap.id() &lt;&lt; <span class="built_in">endl</span>;  </div><div class="line">    <span class="built_in">cout</span> &lt;&lt; <span class="string">"\t email : "</span> &lt;&lt; rap.email() &lt;&lt; <span class="built_in">endl</span>;  </div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="C-String的序列化与反序列化API"><a href="#C-String的序列化与反序列化API" class="headerlink" title="C++ String的序列化与反序列化API"></a>C++ String的序列化与反序列化API</h3><p><strong>除了下述的SerializeToString方法之外，还有方法SerializePartialToString，两者用法相同，其中唯一的区别在于SerializePartialToString允许忽略required字段，而前者不允许</strong></p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//C++string序列化和序列化API  </span></div><div class="line"><span class="function"><span class="keyword">bool</span> <span class="title">SerializeToString</span><span class="params">(<span class="built_in">string</span>* output)</span> <span class="keyword">const</span></span>;  </div><div class="line"><span class="function"><span class="keyword">bool</span> <span class="title">ParseFromString</span><span class="params">(<span class="keyword">const</span> <span class="built_in">string</span>&amp; data)</span></span>;  </div><div class="line"><span class="comment">//使用：  </span></div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">set_people</span><span class="params">()</span>               </span></div><div class="line">&#123;  </div><div class="line">    wp.set_name(<span class="string">"sealyao"</span>);     </div><div class="line">    wp.set_id(<span class="number">123456</span>);          </div><div class="line">    wp.set_email(<span class="string">"sealyaog@gmail.com"</span>);  </div><div class="line">    wp.SerializeToString(&amp;pstring);  </div><div class="line">&#125;  </div><div class="line"></div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">get_people</span><span class="params">()</span>               </span></div><div class="line">&#123;  </div><div class="line">    rsp.ParseFromString(pstring);    </div><div class="line">    <span class="built_in">cout</span> &lt;&lt; <span class="string">"Get People from String:"</span> &lt;&lt; <span class="built_in">endl</span>;  </div><div class="line">    <span class="built_in">cout</span> &lt;&lt; <span class="string">"\t Name : "</span> &lt;&lt;rsp.name() &lt;&lt; <span class="built_in">endl</span>;  </div><div class="line">    <span class="built_in">cout</span> &lt;&lt; <span class="string">"\t Id : "</span> &lt;&lt; rsp.id() &lt;&lt; <span class="built_in">endl</span>;  </div><div class="line">    <span class="built_in">cout</span> &lt;&lt; <span class="string">"\t email : "</span> &lt;&lt; rsp.email() &lt;&lt; <span class="built_in">endl</span>;  </div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="文件描述符序列化与反序列化API"><a href="#文件描述符序列化与反序列化API" class="headerlink" title="文件描述符序列化与反序列化API"></a>文件描述符序列化与反序列化API</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//文件描述符的序列化和序列化API  </span></div><div class="line"><span class="function"><span class="keyword">bool</span> <span class="title">SerializeToFileDescriptor</span><span class="params">(<span class="keyword">int</span> file_descriptor)</span> <span class="keyword">const</span></span>;  </div><div class="line"><span class="function"><span class="keyword">bool</span> <span class="title">ParseFromFileDescriptor</span><span class="params">(<span class="keyword">int</span> file_descriptor)</span></span>;  </div><div class="line"></div><div class="line"><span class="comment">//使用:  </span></div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">set_people</span><span class="params">()</span>  </span></div><div class="line">&#123;  </div><div class="line">   fd = open(path,O_CREAT|O_TRUNC|O_RDWR,<span class="number">0644</span>);  </div><div class="line">   <span class="keyword">if</span>(fd &lt;= <span class="number">0</span>)&#123;  </div><div class="line">       perror(<span class="string">"open"</span>);  </div><div class="line">       <span class="built_in">exit</span>(<span class="number">0</span>);   </div><div class="line">   &#125;     </div><div class="line">   wp.set_name(<span class="string">"sealyaog"</span>);  </div><div class="line">   wp.set_id(<span class="number">123456</span>);  </div><div class="line">   wp.set_email(<span class="string">"sealyaog@gmail.com"</span>);  </div><div class="line">   wp.SerializeToFileDescriptor(fd);     </div><div class="line">   close(fd);  </div><div class="line">&#125;  </div><div class="line"></div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">get_people</span><span class="params">()</span>  </span></div><div class="line">&#123;  </div><div class="line">   fd = open(path,O_RDONLY);  </div><div class="line">   <span class="keyword">if</span>(fd &lt;= <span class="number">0</span>)&#123;  </div><div class="line">       perror(<span class="string">"open"</span>);  </div><div class="line">       <span class="built_in">exit</span>(<span class="number">0</span>);  </div><div class="line">   &#125;  </div><div class="line">   rp.ParseFromFileDescriptor(fd);  </div><div class="line">   <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">"Get People from FD:"</span> &lt;&lt; <span class="built_in">endl</span>;  </div><div class="line">   <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">"\t Name : "</span> &lt;&lt;rp.name() &lt;&lt; <span class="built_in">endl</span>;  </div><div class="line">   <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">"\t Id : "</span> &lt;&lt; rp.id() &lt;&lt; <span class="built_in">endl</span>;  </div><div class="line">   <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">"\t email : "</span> &lt;&lt; rp.email() &lt;&lt; <span class="built_in">endl</span>;  </div><div class="line">   close(fd);  </div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="C-stream-序列化和反序列化API"><a href="#C-stream-序列化和反序列化API" class="headerlink" title="C++ stream 序列化和反序列化API"></a>C++ stream 序列化和反序列化API</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//C++ stream 序列化/反序列化API  </span></div><div class="line"><span class="function"><span class="keyword">bool</span> <span class="title">SerializeToOstream</span><span class="params">(ostream* output)</span> <span class="keyword">const</span></span>;  </div><div class="line"><span class="function"><span class="keyword">bool</span> <span class="title">ParseFromIstream</span><span class="params">(istream* input)</span></span>;  </div><div class="line"></div><div class="line"><span class="comment">//使用：  </span></div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">set_people</span><span class="params">()</span>  </span></div><div class="line">&#123;  </div><div class="line">    <span class="function">fstream <span class="title">fs</span><span class="params">(path,ios::out|ios::trunc|ios::binary)</span></span>;  </div><div class="line">    wp.set_name(<span class="string">"sealyaog"</span>);  </div><div class="line">    wp.set_id(<span class="number">123456</span>);  </div><div class="line">    wp.set_email(<span class="string">"sealyaog@gmail.com"</span>);  </div><div class="line">    wp.SerializeToOstream(&amp;fs);      </div><div class="line">    fs.close();  </div><div class="line">    fs.clear();  </div><div class="line">&#125;  </div><div class="line"></div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">get_people</span><span class="params">()</span>  </span></div><div class="line">&#123;  </div><div class="line">    <span class="function">fstream <span class="title">fs</span><span class="params">(path,ios::in|ios::binary)</span></span>;  </div><div class="line">    rp.ParseFromIstream(&amp;fs);  </div><div class="line">    <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">"\t Name : "</span> &lt;&lt;rp.name() &lt;&lt; <span class="built_in">endl</span>;  </div><div class="line">    <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">"\t Id : "</span> &lt;&lt; rp.id() &lt;&lt; <span class="built_in">endl</span>;   </div><div class="line">    <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">"\t email : "</span> &lt;&lt; rp.email() &lt;&lt; <span class="built_in">endl</span>;     </div><div class="line">    fs.close();  </div><div class="line">    fs.clear();  </div><div class="line">&#125;</div></pre></td></tr></table></figure>
<blockquote>
<p>参考链接：</p>
<p><a href="http://blog.csdn.net/mycwq/article/details/19622571" target="_blank" rel="external">http://blog.csdn.net/mycwq/article/details/19622571</a><br><a href="http://colobu.com/2015/01/07/Protobuf-language-guide/" target="_blank" rel="external">http://colobu.com/2015/01/07/Protobuf-language-guide/</a><br><a href="https://worktile.com/tech/share/prototol-buffers" target="_blank" rel="external">https://worktile.com/tech/share/prototol-buffers</a><br><a href="http://tech.meituan.com/serialization_vs_deserialization.html" target="_blank" rel="external">http://tech.meituan.com/serialization_vs_deserialization.html</a><br><a href="http://blog.csdn.net/weiwangchao_/article/details/16797763" target="_blank" rel="external">http://blog.csdn.net/weiwangchao_/article/details/16797763</a></p>
</blockquote>

                    
                        
                    
                    
                        <p>
                            <a href="/2017/05/26/protobuffer学习总结/#post-footer" class="postShorten-excerpt_link link">
                                Comentar y compartir
                            </a>
                        </p>
                    
                </div>
            
        </div>
        
    </article>
    
    <div class="pagination-bar">
    <ul class="pagination">
        
        
        <li class="pagination-number">página 1 de 1</li>
    </ul>
</div>

</section>


                <footer id="footer" class="main-content-wrap">
    <span class="copyrights">
        Copyrights &copy; 2018 魏传柳(2824759538@qq.com). All Rights Reserved.
    </span>
    <script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js">
     </script>
   </br></br>本文总阅读量<span id="busuanzi_value_page_pv"></span>次
</footer>

            </div>
            
        </div>
        


    
        
    

<div id="about">
    <div id="about-card">
        <div id="about-btn-close">
            <i class="fa fa-remove"></i>
        </div>
        
            <img id="about-card-picture" src="/assets/images/avar.jpg"/>
        
            <h4 id="about-card-name">魏传柳(2824759538@qq.com)</h4>
        
            <h5 id="about-card-bio"><p>author.bio</p>
</h5>
        
        
            <h5 id="about-card-job">
                <i class="fa fa-briefcase"></i>
                <br/>
                <p>Tencent</p>

            </h5>
        
        
            <h5 id="about-card-location">
                <i class="fa fa-map-marker"></i>
                <br/>
                ShenZhen,China
            </h5>
        
    </div>
</div>

        
<div id="cover" style="background-image:url('/assets/images/cover.jpg');"></div>
    </body>
    <!--SCRIPTS-->
<script src="/assets/js/script-i4qo6jx6jji9fg0dftpya6ivemizsbow4fhow76d8dwpm7m1wbvi378ssumx.min.js"></script>
<!--SCRIPTS END-->



</html>
